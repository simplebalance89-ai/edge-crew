<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Edge Finder — Crew Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;900&family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box;}
body{background:#0D0D1A;color:#fff;font-family:'Nunito',sans-serif;min-height:100vh;padding-bottom:70px;}

/* ===== TOP BAR ===== */
.topbar{
    display:flex;align-items:center;justify-content:space-between;
    padding:12px 24px;border-bottom:1px solid rgba(255,255,255,0.06);
    background:rgba(0,0,0,0.3);position:sticky;top:0;z-index:100;
    backdrop-filter:blur(12px);
}
.topbar-left{display:flex;align-items:center;gap:12px;}
.topbar-title{font-family:'Playfair Display',serif;font-size:18px;
    background:linear-gradient(135deg,#D4A017,#FFE082);-webkit-background-clip:text;-webkit-text-fill-color:transparent;}
.topbar-date{font-size:12px;color:rgba(255,255,255,0.3);}
.crew{display:flex;gap:8px;}
.crew-badge{padding:4px 10px;border-radius:20px;font-size:11px;font-weight:700;letter-spacing:0.5px;}
.crew-peter{background:rgba(212,160,23,0.15);color:#D4A017;border:1px solid rgba(212,160,23,0.3);}
.crew-chinny{background:rgba(16,185,129,0.15);color:#10B981;border:1px solid rgba(16,185,129,0.3);}
.crew-jimmy{background:rgba(96,165,250,0.15);color:#60A5FA;border:1px solid rgba(96,165,250,0.3);}
.crew-sintonia{background:rgba(167,139,250,0.15);color:#A78BFA;border:1px solid rgba(167,139,250,0.3);}
.sweep-time{font-size:11px;color:rgba(255,255,255,0.25);text-align:right;}

/* ===== SPORT TABS ===== */
.sport-tabs{
    display:flex;gap:0;padding:0 24px;background:rgba(0,0,0,0.2);
    border-bottom:1px solid rgba(255,255,255,0.06);overflow-x:auto;
}
.sport-tab{
    padding:12px 28px;font-size:13px;font-weight:700;letter-spacing:1px;
    text-transform:uppercase;color:rgba(255,255,255,0.3);cursor:pointer;
    border-bottom:3px solid transparent;transition:all 0.2s;white-space:nowrap;
}
.sport-tab:hover{color:rgba(255,255,255,0.6);}
.sport-tab.active{color:#fff;border-bottom-color:#D4A017;}
.sport-tab .tab-count{
    display:inline-block;margin-left:6px;padding:2px 6px;border-radius:10px;
    font-size:10px;background:rgba(255,255,255,0.08);color:rgba(255,255,255,0.4);
}
.sport-tab.active .tab-count{background:rgba(212,160,23,0.2);color:#D4A017;}

/* ===== CONTENT ===== */
.content{max-width:1100px;margin:0 auto;padding:24px;}
.sport-panel{display:none;}
.sport-panel.active{display:block;}

/* ===== GOTCHA BANNER ===== */
.gotcha-banner{
    background:rgba(239,68,68,0.06);border:1px solid rgba(239,68,68,0.2);
    border-radius:12px;padding:16px 20px;margin-bottom:24px;
}
.gotcha-banner h3{color:#EF4444;font-family:'Playfair Display',serif;font-size:16px;margin-bottom:10px;}
.gotcha-banner li{color:rgba(255,255,255,0.6);font-size:13px;margin-bottom:6px;line-height:1.5;}

/* ===== GAME ROWS ===== */
.game-row{
    background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.06);
    border-radius:12px;padding:0;margin-bottom:12px;overflow:hidden;
    transition:all 0.2s;cursor:pointer;
}
.game-row:hover{border-color:rgba(212,160,23,0.3);background:rgba(255,255,255,0.03);}
.game-row.expanded{border-color:rgba(212,160,23,0.4);}
.game-row.pass{opacity:0.4;}
.game-row.pass:hover{opacity:0.7;}
.game-row[data-complete="false"]{border-left:3px solid rgba(251,191,36,0.4) !important;}
.game-row.checked{border-color:rgba(16,185,129,0.5);background:rgba(16,185,129,0.04);}

/* ===== CHECKBOXES ===== */
.pick-check{
    width:22px;height:22px;border-radius:6px;border:2px solid rgba(255,255,255,0.15);
    background:transparent;cursor:pointer;transition:all 0.2s;flex-shrink:0;
    display:flex;align-items:center;justify-content:center;
}
.pick-check:hover{border-color:rgba(212,160,23,0.5);}
.pick-check.on{background:#10B981;border-color:#10B981;}
.pick-check.on::after{content:'';display:block;width:6px;height:10px;border:solid #000;border-width:0 2.5px 2.5px 0;transform:rotate(45deg);margin-top:-2px;}

/* ===== SIDE SELECTOR ===== */
.side-select{
    display:flex;gap:4px;margin-left:8px;
}
.side-btn{
    padding:4px 10px;border-radius:6px;font-size:11px;font-weight:700;
    border:1px solid rgba(255,255,255,0.1);background:transparent;
    color:rgba(255,255,255,0.4);cursor:pointer;transition:all 0.2s;
}
.side-btn:hover{border-color:rgba(212,160,23,0.4);color:rgba(255,255,255,0.7);}
.side-btn.picked{background:rgba(212,160,23,0.2);border-color:#D4A017;color:#D4A017;}

/* ===== SUBMIT BAR ===== */
.submit-bar{
    position:fixed;bottom:0;left:0;right:0;
    background:rgba(13,13,26,0.95);backdrop-filter:blur(12px);
    border-top:1px solid rgba(212,160,23,0.3);
    padding:12px 24px;display:flex;align-items:center;justify-content:space-between;
    transform:translateY(100%);transition:transform 0.3s ease;z-index:200;
}
.submit-bar.visible{transform:translateY(0);}
.submit-count{font-size:14px;color:rgba(255,255,255,0.6);}
.submit-count strong{color:#D4A017;}
.submit-btn{
    padding:10px 32px;border-radius:24px;border:none;
    background:linear-gradient(135deg,#D4A017,#B8860B);color:#0D0D1A;
    font-family:'Nunito',sans-serif;font-size:14px;font-weight:800;
    cursor:pointer;transition:all 0.2s;letter-spacing:0.5px;
}
.submit-btn:hover{transform:scale(1.05);box-shadow:0 4px 20px rgba(212,160,23,0.4);}

/* ===== LOCKED CARD MODAL ===== */
.modal-overlay{
    position:fixed;top:0;left:0;right:0;bottom:0;
    background:rgba(0,0,0,0.8);backdrop-filter:blur(8px);
    display:none;align-items:center;justify-content:center;z-index:300;
    padding:24px;
}
.modal-overlay.show{display:flex;}
.modal{
    background:#0D0D1A;border:1px solid rgba(212,160,23,0.3);border-radius:16px;
    padding:32px;max-width:700px;width:100%;max-height:80vh;overflow-y:auto;
}
.modal h2{font-family:'Playfair Display',serif;color:#D4A017;margin-bottom:4px;}
.modal .modal-sub{font-size:12px;color:rgba(255,255,255,0.3);margin-bottom:20px;}
.modal table{width:100%;border-collapse:collapse;}
.modal th{text-align:left;padding:8px;font-size:11px;color:#D4A017;text-transform:uppercase;letter-spacing:1px;border-bottom:1px solid rgba(255,255,255,0.08);}
.modal td{padding:8px;font-size:14px;color:rgba(255,255,255,0.8);border-bottom:1px solid rgba(255,255,255,0.04);}
.modal-close{
    margin-top:20px;padding:10px 24px;border-radius:8px;border:1px solid rgba(255,255,255,0.1);
    background:transparent;color:#fff;font-family:'Nunito',sans-serif;font-size:13px;
    cursor:pointer;
}
.modal-close:hover{border-color:rgba(255,255,255,0.3);}

.game-header{
    display:grid;grid-template-columns:30px 60px 1fr 100px 80px 60px 1fr;
    align-items:center;padding:14px 20px;gap:12px;
}
.game-time{font-size:12px;color:rgba(255,255,255,0.4);font-weight:600;}
.game-matchup{font-family:'Playfair Display',serif;font-size:16px;font-weight:700;}
.game-matchup .away{color:rgba(255,255,255,0.5);}
.game-matchup .home{color:#fff;}
.game-spread{font-size:14px;font-weight:700;color:#D4A017;text-align:center;}
.game-total{font-size:13px;color:rgba(255,255,255,0.4);text-align:center;}
.game-grade{text-align:center;}
.game-edge{font-size:12px;color:rgba(255,255,255,0.5);line-height:1.4;}

.grade{display:inline-block;padding:4px 10px;border-radius:6px;font-weight:800;font-size:12px;}
.ga{background:#10B981;color:#000;} .gam{background:#10B981;color:#000;}
.gbp{background:#2563EB;color:#fff;} .gb{background:#3B82F6;color:#fff;} .gbm{background:#3B82F6;color:#fff;}
.gc{background:#F59E0B;color:#000;} .gcm{background:#F59E0B;color:#000;}
.gd{background:#EF4444;color:#fff;} .gf{background:#7F1D1D;color:#fff;}

/* ===== EXPANDED DETAIL ===== */
.game-detail{
    display:none;padding:0 20px 16px;border-top:1px solid rgba(255,255,255,0.04);
}
.game-row.expanded .game-detail{display:block;}
.detail-grid{display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-top:12px;}
.detail-box{background:rgba(255,255,255,0.02);border-radius:8px;padding:14px;}
.detail-box h4{font-size:11px;text-transform:uppercase;letter-spacing:1.5px;margin-bottom:8px;}
.detail-box.peter h4{color:#D4A017;}
.detail-box.chinny h4{color:#10B981;}
.detail-box.trends h4{color:#A78BFA;}
.detail-box.flags h4{color:#EF4444;}
.detail-box li,.detail-box p{font-size:13px;color:rgba(255,255,255,0.6);margin-bottom:4px;line-height:1.5;}

/* ===== TAGS ===== */
.tag{display:inline-block;padding:2px 8px;border-radius:4px;font-size:10px;font-weight:700;margin-right:4px;}
.tag-b2b{background:rgba(245,158,11,0.15);color:#F59E0B;}
.tag-rust{background:rgba(167,139,250,0.15);color:#A78BFA;}
.tag-trap{background:rgba(239,68,68,0.15);color:#EF4444;}
.tag-home{background:rgba(16,185,129,0.15);color:#10B981;}
.tag-upset{background:rgba(212,160,23,0.15);color:#D4A017;}

/* ===== UPSET SPECIALS ===== */
.upset-section{
    margin-top:24px;background:rgba(212,160,23,0.04);border:1px solid rgba(212,160,23,0.15);
    border-radius:12px;padding:20px;
}
.upset-section h3{font-family:'Playfair Display',serif;color:#D4A017;font-size:16px;margin-bottom:12px;}
.upset-row{display:grid;grid-template-columns:1fr 80px 2fr 60px;align-items:center;padding:8px 0;border-bottom:1px solid rgba(255,255,255,0.04);}
.upset-row:last-child{border-bottom:none;}
.upset-dog{font-weight:700;font-size:14px;}
.upset-ml{color:#10B981;font-weight:800;font-size:14px;text-align:center;}
.upset-thesis{font-size:13px;color:rgba(255,255,255,0.5);}

/* ===== PETER INPUT ===== */
.input-section{
    margin-top:24px;background:rgba(212,160,23,0.04);border:2px dashed rgba(212,160,23,0.25);
    border-radius:12px;padding:20px;
}
.input-section h3{font-family:'Playfair Display',serif;color:#D4A017;font-size:16px;margin-bottom:8px;}
.input-section p{font-size:13px;color:rgba(255,255,255,0.4);line-height:1.6;}

/* ===== COMBINED VIEW ===== */
.combined-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:16px;}
.combined-header h2{font-family:'Playfair Display',serif;font-size:20px;}
.combined-stat{display:flex;gap:16px;}
.stat-pill{padding:6px 14px;border-radius:20px;font-size:12px;font-weight:700;background:rgba(255,255,255,0.04);color:rgba(255,255,255,0.5);}

/* ===== SUBMIT PICK FORM ===== */
.pick-form{max-width:600px;margin:0 auto;}
.pick-form h2{font-family:'Playfair Display',serif;font-size:22px;margin-bottom:4px;
    background:linear-gradient(135deg,#D4A017,#FFE082);-webkit-background-clip:text;-webkit-text-fill-color:transparent;}
.pick-form .form-sub{font-size:13px;color:rgba(255,255,255,0.4);margin-bottom:24px;}
.form-group{margin-bottom:16px;}
.form-group label{display:block;font-size:12px;font-weight:700;color:rgba(255,255,255,0.5);
    text-transform:uppercase;letter-spacing:1px;margin-bottom:6px;}
.form-group input,.form-group select,.form-group textarea{
    width:100%;padding:12px 16px;border-radius:10px;border:1px solid rgba(255,255,255,0.1);
    background:rgba(255,255,255,0.04);color:#fff;font-family:'Nunito',sans-serif;font-size:14px;
    transition:border-color 0.2s;
}
.form-group input:focus,.form-group select:focus,.form-group textarea:focus{
    outline:none;border-color:rgba(212,160,23,0.5);
}
.form-group select{appearance:none;cursor:pointer;}
.form-group select option{background:#0D0D1A;color:#fff;}
.form-group textarea{resize:vertical;min-height:60px;}
.form-row{display:grid;grid-template-columns:1fr 1fr;gap:12px;}
.confidence-btns{display:flex;gap:8px;}
.conf-btn{padding:8px 16px;border-radius:8px;border:1px solid rgba(255,255,255,0.1);
    background:transparent;color:rgba(255,255,255,0.4);font-family:'Nunito',sans-serif;
    font-size:13px;font-weight:700;cursor:pointer;transition:all 0.2s;flex:1;text-align:center;}
.conf-btn:hover{border-color:rgba(212,160,23,0.4);color:rgba(255,255,255,0.7);}
.conf-btn.active{background:rgba(212,160,23,0.2);border-color:#D4A017;color:#D4A017;}
.submit-pick-btn{
    width:100%;padding:14px;border-radius:12px;border:none;margin-top:8px;
    background:linear-gradient(135deg,#D4A017,#B8860B);color:#0D0D1A;
    font-family:'Nunito',sans-serif;font-size:16px;font-weight:800;
    cursor:pointer;transition:all 0.2s;letter-spacing:0.5px;
}
.submit-pick-btn:hover{transform:scale(1.02);box-shadow:0 4px 20px rgba(212,160,23,0.4);}
.pick-history{margin-top:32px;}
.pick-history h3{font-family:'Playfair Display',serif;font-size:16px;color:#D4A017;margin-bottom:12px;}
.pick-card{background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.06);
    border-radius:10px;padding:14px 18px;margin-bottom:8px;display:flex;justify-content:space-between;align-items:center;}
.pick-card .pick-main{font-size:14px;font-weight:700;}
.pick-card .pick-meta{font-size:12px;color:rgba(255,255,255,0.4);}
.pick-card .pick-conf{font-size:11px;font-weight:700;padding:4px 10px;border-radius:6px;}
.pick-conf.fire{background:rgba(239,68,68,0.15);color:#EF4444;}
.pick-conf.strong{background:rgba(212,160,23,0.15);color:#D4A017;}
.pick-conf.lean{background:rgba(96,165,250,0.15);color:#60A5FA;}
.toast{position:fixed;top:20px;left:50%;transform:translateX(-50%) translateY(-100px);
    background:#10B981;color:#000;font-weight:800;font-size:14px;padding:12px 28px;
    border-radius:12px;z-index:999;transition:transform 0.3s ease;pointer-events:none;}
.toast.show{transform:translateX(-50%) translateY(0);}

/* ===== BET SLIP POPUP ===== */
.betslip-overlay{
    position:fixed;top:0;left:0;right:0;bottom:0;
    background:rgba(0,0,0,0.7);backdrop-filter:blur(6px);
    display:none;align-items:flex-end;justify-content:center;z-index:400;
    padding:0;
}
.betslip-overlay.show{display:flex;}
.betslip-card{
    background:#0D0D1A;border:1px solid rgba(212,160,23,0.4);
    border-radius:20px 20px 0 0;padding:24px 20px 28px;
    width:100%;max-width:480px;
    transform:translateY(100%);transition:transform 0.3s ease;
    max-height:85vh;overflow-y:auto;
}
.betslip-overlay.show .betslip-card{transform:translateY(0);}
.slip-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;}
.slip-title{font-family:'Playfair Display',serif;font-size:18px;color:#D4A017;font-weight:900;letter-spacing:1px;}
.slip-close{background:none;border:none;color:rgba(255,255,255,0.4);font-size:24px;cursor:pointer;padding:4px 8px;}
.slip-close:hover{color:#fff;}
.slip-pick{font-size:20px;font-weight:800;color:#fff;margin-bottom:4px;}
.slip-meta{font-size:13px;color:rgba(255,255,255,0.4);margin-bottom:16px;}
.slip-label{font-size:11px;font-weight:700;color:rgba(255,255,255,0.5);text-transform:uppercase;letter-spacing:1px;margin-bottom:6px;margin-top:14px;}
.slip-btn-group{display:flex;gap:6px;flex-wrap:wrap;}
.slip-btn{
    padding:8px 16px;border-radius:8px;border:1px solid rgba(255,255,255,0.1);
    background:transparent;color:rgba(255,255,255,0.4);font-family:'Nunito',sans-serif;
    font-size:13px;font-weight:700;cursor:pointer;transition:all 0.2s;flex:1;text-align:center;
    min-width:60px;
}
.slip-btn:hover{border-color:rgba(212,160,23,0.4);color:rgba(255,255,255,0.7);}
.slip-btn.active{background:rgba(212,160,23,0.2);border-color:#D4A017;color:#D4A017;}
.slip-odds-input{
    width:100px;padding:8px 12px;border-radius:8px;border:1px solid rgba(255,255,255,0.1);
    background:rgba(255,255,255,0.04);color:#fff;font-family:'Nunito',sans-serif;
    font-size:14px;font-weight:700;text-align:center;
}
.slip-odds-input:focus{outline:none;border-color:rgba(212,160,23,0.5);}
.slip-note-toggle{
    background:none;border:none;color:rgba(212,160,23,0.6);font-size:13px;
    cursor:pointer;padding:0;margin-top:12px;font-family:'Nunito',sans-serif;
}
.slip-note-toggle:hover{color:#D4A017;}
.slip-note-area{
    width:100%;padding:10px 14px;border-radius:8px;border:1px solid rgba(255,255,255,0.1);
    background:rgba(255,255,255,0.04);color:#fff;font-family:'Nunito',sans-serif;
    font-size:13px;resize:vertical;min-height:50px;margin-top:6px;display:none;
}
.slip-note-area:focus{outline:none;border-color:rgba(212,160,23,0.5);}
.betslip-submit{
    width:100%;padding:14px;border-radius:12px;border:none;margin-top:16px;
    background:linear-gradient(135deg,#D4A017,#B8860B);color:#0D0D1A;
    font-family:'Nunito',sans-serif;font-size:16px;font-weight:800;
    cursor:pointer;transition:all 0.2s;letter-spacing:0.5px;
}
.betslip-submit:hover{transform:scale(1.02);box-shadow:0 4px 20px rgba(212,160,23,0.4);}
.betslip-submit:disabled{opacity:0.5;cursor:not-allowed;transform:none;box-shadow:none;}
@media(min-width:769px){
    .betslip-overlay{align-items:center;}
    .betslip-card{border-radius:20px;max-height:80vh;}
}

/* ===== FOOTER ===== */
.footer{
    text-align:center;padding:32px 24px;margin-top:32px;
    border-top:1px solid rgba(255,255,255,0.06);
    color:rgba(255,255,255,0.2);font-size:11px;
}

/* ===== LOADING OVERLAY ===== */
.panel-loading{position:relative;min-height:120px;}
.panel-loading::after{
    content:'Loading...';position:absolute;top:0;left:0;right:0;bottom:0;
    background:rgba(13,13,26,0.85);display:flex;align-items:center;justify-content:center;
    font-size:14px;color:rgba(255,255,255,0.5);font-weight:700;letter-spacing:1px;
    border-radius:12px;z-index:10;
}
.panel-error{
    text-align:center;padding:20px;color:#EF4444;font-size:13px;font-weight:700;
    background:rgba(239,68,68,0.06);border:1px solid rgba(239,68,68,0.2);
    border-radius:12px;margin:12px 0;
}

/* ===== EMPTY STATE ===== */
.empty-state{
    text-align:center;padding:40px 20px;color:rgba(255,255,255,0.35);font-size:14px;line-height:1.6;
}
.empty-state strong{color:rgba(255,255,255,0.5);}

/* ===== TAB SCROLL AFFORDANCE ===== */
.tabs-wrapper{position:relative;}
.tabs-wrapper::after{
    content:'';position:absolute;right:0;top:0;bottom:0;width:40px;
    background:linear-gradient(to right,transparent,rgba(0,0,0,0.8));
    pointer-events:none;z-index:2;
}
.sport-tabs{scroll-snap-type:x mandatory;-webkit-overflow-scrolling:touch;}
.sport-tab{scroll-snap-align:start;}

/* ===== TOPBAR REFRESH BTN ===== */
.topbar-refresh{
    cursor:pointer;padding:4px 10px;border-radius:20px;font-size:11px;font-weight:700;
    background:rgba(239,68,68,0.15);color:#EF4444;border:1px solid rgba(239,68,68,0.3);
    letter-spacing:0.5px;font-family:'Nunito',sans-serif;white-space:nowrap;
}
.topbar-refresh:hover{background:rgba(239,68,68,0.25);}

/* ===== COMBINED MOBILE CARDS ===== */
.combined-card{
    background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.06);
    border-radius:10px;padding:12px 16px;margin-bottom:8px;
}
.combined-card-top{display:flex;justify-content:space-between;align-items:center;margin-bottom:6px;}
.combined-card-matchup{font-size:15px;font-weight:700;color:#fff;}
.combined-card-sport{font-size:10px;font-weight:700;padding:2px 8px;border-radius:4px;display:inline-block;}
.combined-card-lines{display:flex;gap:12px;flex-wrap:wrap;font-size:12px;color:rgba(255,255,255,0.5);}
.combined-card-lines span{white-space:nowrap;}
.combined-card-status{margin-top:6px;}

/* ===== RESPONSIVE ===== */
@media(max-width:768px){
    /* Game header → stacked card */
    .game-header{
        display:flex !important;flex-wrap:wrap;gap:8px;padding:12px 16px;
        grid-template-columns:none !important;
    }
    .game-header .pick-check{order:0;}
    .game-header .game-time{order:1;flex:1;font-size:11px;}
    .game-header .game-grade{order:2;}
    .game-header .game-matchup{order:3;width:100%;font-size:15px;}
    .game-header .game-spread{order:4;font-size:13px;text-align:left;}
    .game-header .game-total{order:5;font-size:12px;text-align:left;display:block !important;}
    .game-header .game-edge{order:6;width:100%;display:block !important;font-size:11px;padding-top:6px;border-top:1px solid rgba(255,255,255,0.06);}

    /* Touch targets: 44px minimum */
    .side-btn{min-height:44px;padding:10px 12px;font-size:12px;display:flex;align-items:center;justify-content:center;}
    .side-select{display:grid !important;grid-template-columns:1fr 1fr;gap:6px;width:100%;margin-left:0;margin-top:8px;}
    .pick-check{width:36px !important;height:36px !important;min-width:36px;}
    .slip-btn{min-height:44px;display:flex;align-items:center;justify-content:center;}
    .conf-btn{min-height:44px;display:flex;align-items:center;justify-content:center;}
    .sport-tab{padding:12px 20px;min-height:44px;display:flex;align-items:center;}

    .detail-grid{grid-template-columns:1fr;}
    .topbar{flex-wrap:wrap;gap:8px;}
    .crew{flex-wrap:wrap;}
    .upset-row{grid-template-columns:1fr 60px 1fr 50px;}

    /* Combined table → cards */
    #combinedTableContainer table{display:none !important;}
    .combined-cards-mobile{display:block !important;}
}
@media(min-width:769px){
    .combined-cards-mobile{display:none !important;}
    .tabs-wrapper::after{display:none;}
}
</style>
</head>
<body>

<!-- TOP BAR -->
<div class="topbar">
    <div class="topbar-left">
        <div class="topbar-title">Edge Finder</div>
        <div class="topbar-date" id="topbarDate"></div>
    </div>
    <div class="crew">
        <span class="crew-badge crew-peter">Peter</span>
        <span class="crew-badge crew-chinny">Chinny</span>
        <span class="crew-badge crew-jimmy">Jimmy</span>
        <span class="crew-badge crew-sintonia">Sinton.ia</span>
    </div>
    <div class="sweep-time" id="sweepTime">Last sweep: --<br>Waiting for refresh</div>
    <div style="display:flex;gap:6px;align-items:center;">
        <button class="topbar-refresh" onclick="refreshSlate()">REFRESH SLATE</button>
        <button onclick="clearAllCache()" style="cursor:pointer;padding:4px 10px;border-radius:20px;font-size:11px;font-weight:700;background:rgba(239,68,68,0.15);color:#EF4444;border:1px solid rgba(239,68,68,0.3);letter-spacing:0.5px;font-family:'Nunito',sans-serif;">CLEAR CACHE</button>
    </div>
</div>

<!-- SPORT TABS -->
<div class="tabs-wrapper">
<div class="sport-tabs">
    <div class="sport-tab active" onclick="switchSport('nba', event)">NBA <span class="tab-count">6</span></div>
    <div class="sport-tab" onclick="switchSport('nhl', event)">NHL <span class="tab-count">8</span></div>
    <div class="sport-tab" onclick="switchSport('soccer', event)">Soccer <span class="tab-count">0</span></div>
    <div class="sport-tab" onclick="switchSport('mma', event)">MMA <span class="tab-count">0</span></div>
    <div class="sport-tab" onclick="switchSport('boxing', event)">Boxing <span class="tab-count">0</span></div>
    <div class="sport-tab" onclick="switchSport('props', event)">Props <span class="tab-count">30</span></div>
    <div class="sport-tab" onclick="switchSport('combined', event)">Combined <span class="tab-count">14</span></div>
    <div class="sport-tab" onclick="switchSport('bankroll', event)">RESULTS <span class="tab-count">0</span></div>
    <div class="sport-tab" onclick="switchSport('submit', event)" style="color:#10B981;">SUBMIT PICK</div>
</div>
</div>

<!-- CONTENT -->
<div class="content">

<!-- ===== NBA PANEL ===== -->
<div class="sport-panel active" id="panel-nba">

<div class="gotcha-banner" id="gotchaCard">
    <div style="display:flex;justify-content:space-between;align-items:center;">
        <h3 id="gotchaNBATitle">Gotcha Card &mdash; NBA Feb 25</h3>
        <div style="display:flex;gap:6px;">
            <button style="cursor:pointer;padding:4px 10px;border-radius:4px;background:rgba(212,160,23,0.15);color:#D4A017;font-size:11px;font-weight:700;border:none;" onclick="toggleGotchaEdit()">EDIT</button>
            <button style="cursor:pointer;padding:4px 10px;border-radius:4px;background:rgba(16,185,129,0.15);color:#10B981;font-size:11px;font-weight:700;border:none;" onclick="saveGotcha()">SAVE</button>
        </div>
    </div>
    <div id="gotchaDisplay">
        <ul>
            <li><strong>OKC is a G-League team tonight.</strong> SGA OUT, Jalen Williams OUT, Chet DOUBTFUL, Ajay Mitchell OUT, Caruso QUESTIONABLE. On B2B &mdash; played Toronto Tuesday.</li>
            <li><strong>SA on a 9-game win streak.</strong> 8-1 ATS during streak. Facing TOR on B2B with Barnes QUESTIONABLE. Best bet on the board.</li>
            <li><strong>CLE line crashed from -8.5 to -3.</strong> Mitchell OUT + Mobley OUT + Harden QUESTIONABLE. Lean MIL +3 if Harden sits. Confirm at game time.</li>
            <li><strong>SAC is decimated.</strong> Sabonis OUT for season, LaVine OUT for season. 12-44 record. HOU -14 is season-high &mdash; UNDER 222.5 is the sharper play.</li>
            <li><strong>BOS +3.5 at DEN is the sharp play.</strong> BOS 20-9-1 ATS on road, covers 8 of last 9 as dogs. DEN 1-of-5 last 5 covering at home. Brown QUESTIONABLE.</li>
            <li><strong>GS @ MEM &mdash; PASS GAME.</strong> Both teams gutted. Curry OUT, Butler OUT (season), Seth Curry OUT / Ja OUT, Edey OUT, Aldama OUT. Skip.</li>
        </ul>
    </div>
    <textarea id="gotchaEditor" style="display:none;width:100%;min-height:150px;background:#0D0D1A;color:#fff;border:1px solid #D4A017;border-radius:6px;padding:10px;font-family:'Nunito',sans-serif;font-size:13px;resize:vertical;margin-top:8px;" placeholder="One note per line. Use for injuries, traps, edges, B2B flags..."></textarea>
</div>

<!-- OKC @ DET -->
<div class="game-row" data-game="OKC @ DET" onclick="this.classList.toggle('expanded')">
    <div class="game-header">
        <div class="pick-check" onclick="togglePick(event, this, 'OKC @ DET')"></div>
        <div class="game-time">7:30 ET</div>
        <div class="game-matchup"><span class="away">OKC</span> @ <span class="home">DET</span>
            <div class="side-select">
                <div class="side-btn" onclick="pickSide(event,this,'OKC +10.5')">OKC +10.5</div>
                <div class="side-btn" onclick="pickSide(event,this,'DET -10.5')">DET -10.5</div>
                <div class="side-btn" onclick="pickSide(event,this,'OVER 220.5')">OVER</div>
                <div class="side-btn" onclick="pickSide(event,this,'UNDER 220.5')">UNDER</div>
            </div>
        </div>
        <div class="game-spread">DET -10.5</div>
        <div class="game-total">O/U 220.5</div>
        <div class="game-grade"><span class="grade gam">A-</span></div>
        <div class="game-edge"><span class="tag tag-b2b">B2B</span> OKC shell squad. SGA+JW+Chet all out. Cade showcase.</div>
    </div>
    <div class="game-detail">
        <div class="detail-grid">
            <div class="detail-box peter">
                <h4>Peter's Zone</h4>
                <p>DET is the smash. OKC without 4 starters on a B2B is a G-League team. Cade goes off. DET ML parlay leg. 10.5 is wide but they cover. If Chet sits, it's a lock. Cason Wallace went for 27 last night &mdash; tired legs tonight.</p>
            </div>
            <div class="detail-box trends">
                <h4>Trends</h4>
                <ul>
                    <li>OKC 0-4 ATS without SGA this season</li>
                    <li>DET 21-7 at home this season</li>
                    <li>DET 12-3 UNDER last 15 home games</li>
                    <li>Cason Wallace 27 pts last night &mdash; tired legs</li>
                </ul>
            </div>
            <div class="detail-box flags">
                <h4>Flags</h4>
                <ul>
                    <li>Chet DOUBTFUL (back) &mdash; if he sits it's a lock</li>
                    <li>Caruso QUESTIONABLE (ankle)</li>
                    <li>Isaiah Stewart OUT (suspension) for DET</li>
                    <li>Ajay Mitchell OUT, SGA OUT, JW OUT for OKC</li>
                </ul>
            </div>
            <div class="detail-box chinny">
                <h4>Chinny's Props Zone</h4>
                <ul>
                    <li>Cade pts O 26.5 &mdash; OKC shell, showcase game</li>
                    <li>Cade ast O 8.5 &mdash; OKC can't guard PnR</li>
                    <li>OKC team total U 105.5 &mdash; who scores?</li>
                </ul>
            </div>
        </div>
    </div>
</div>

<!-- GS @ MEM -->
<div class="game-row pass" data-game="GS @ MEM" onclick="this.classList.toggle('expanded')">
    <div class="game-header">
        <div class="pick-check" onclick="togglePick(event, this, 'GS @ MEM')"></div>
        <div class="game-time">7:30 ET</div>
        <div class="game-matchup"><span class="away">GS</span> @ <span class="home">MEM</span>
            <div class="side-select">
                <div class="side-btn" onclick="pickSide(event,this,'GS -4.5')">GS -4.5</div>
                <div class="side-btn" onclick="pickSide(event,this,'MEM +4.5')">MEM +4.5</div>
                <div class="side-btn" onclick="pickSide(event,this,'OVER 225.5')">OVER</div>
                <div class="side-btn" onclick="pickSide(event,this,'UNDER 225.5')">UNDER</div>
            </div>
        </div>
        <div class="game-spread">GS -4.5</div>
        <div class="game-total">O/U 225.5</div>
        <div class="game-grade"><span class="grade gcm">C+</span></div>
        <div class="game-edge"><span class="tag tag-trap">PASS</span> Both teams gutted. Curry OUT. Ja OUT. Coin flip.</div>
    </div>
    <div class="game-detail">
        <div class="detail-grid">
            <div class="detail-box peter">
                <h4>Peter's Zone</h4>
                <p>Two skeleton teams. Neither has their guy. Low conviction. PASS unless line moves. If forced, MEM +4.5 at home &mdash; they cover as dogs. GS 3-7 ATS last 10.</p>
            </div>
            <div class="detail-box trends">
                <h4>Trends</h4>
                <ul>
                    <li>GS 3-7 ATS last 10 games</li>
                    <li>MEM 6-4 ATS last 10 despite 3-7 SU</li>
                    <li>Both teams combined 232 PPG last 10</li>
                </ul>
            </div>
            <div class="detail-box flags">
                <h4>Flags</h4>
                <ul>
                    <li>GS: Curry OUT (knee), Butler OUT (season), Seth Curry OUT (back)</li>
                    <li>MEM: Ja OUT (UCL sprain), Edey OUT (ankle), Aldama OUT</li>
                    <li>Both teams decimated &mdash; inflated lines. PASS.</li>
                </ul>
            </div>
        </div>
    </div>
</div>

<!-- SA @ TOR -->
<div class="game-row" data-game="SA @ TOR" onclick="this.classList.toggle('expanded')">
    <div class="game-header">
        <div class="pick-check" onclick="togglePick(event, this, 'SA @ TOR')"></div>
        <div class="game-time">7:30 ET</div>
        <div class="game-matchup"><span class="away">SA</span> @ <span class="home">TOR</span>
            <div class="side-select">
                <div class="side-btn" onclick="pickSide(event,this,'SA -5.5')">SA -5.5</div>
                <div class="side-btn" onclick="pickSide(event,this,'TOR +5.5')">TOR +5.5</div>
                <div class="side-btn" onclick="pickSide(event,this,'OVER 229.5')">OVER</div>
                <div class="side-btn" onclick="pickSide(event,this,'UNDER 229.5')">UNDER</div>
            </div>
        </div>
        <div class="game-spread">SA -5.5</div>
        <div class="game-total">O/U 229.5</div>
        <div class="game-grade"><span class="grade ga">A</span></div>
        <div class="game-edge"><span class="tag tag-home">BEST BET</span> 9-game win streak. TOR B2B. Barnes questionable.</div>
    </div>
    <div class="game-detail">
        <div class="detail-grid">
            <div class="detail-box peter">
                <h4>Peter's Zone</h4>
                <p>SA is the best bet on the board. 9-game win streak, 8-1 ATS during streak, 6-1 ATS last 7 road. Facing a tired TOR on B2B with Barnes questionable. SA -5.5 is the play. Wemby dominates. If Barnes sits, SA covers by 15+.</p>
            </div>
            <div class="detail-box trends">
                <h4>Trends</h4>
                <ul>
                    <li>SA 9-game win streak &mdash; hottest team in the league</li>
                    <li>SA 8-1 ATS during win streak</li>
                    <li>SA 6-1 ATS last 7 road games</li>
                    <li>SA won first meeting 121-103</li>
                    <li>TOR on B2B (played Tuesday, got run by Thunder)</li>
                </ul>
            </div>
            <div class="detail-box flags">
                <h4>Flags</h4>
                <ul>
                    <li>Barnes QUESTIONABLE (quad contusion, left Q4 last night) &mdash; CRITICAL</li>
                    <li>Plumlee OUT for SA (only SA injury)</li>
                    <li>If Barnes sits, SA covers by 15+ easily</li>
                </ul>
            </div>
            <div class="detail-box chinny">
                <h4>Chinny's Props Zone</h4>
                <ul>
                    <li>Wemby pts+reb O 35.5 &mdash; TOR has no answer</li>
                    <li>SA team total O 118.5 &mdash; TOR B2B defense cooked</li>
                </ul>
            </div>
        </div>
    </div>
</div>

<!-- CLE @ MIL -->
<div class="game-row" data-game="CLE @ MIL" onclick="this.classList.toggle('expanded')">
    <div class="game-header">
        <div class="pick-check" onclick="togglePick(event, this, 'CLE @ MIL')"></div>
        <div class="game-time">8:00 ET</div>
        <div class="game-matchup"><span class="away">CLE</span> @ <span class="home">MIL</span>
            <div class="side-select">
                <div class="side-btn" onclick="pickSide(event,this,'CLE -3.0')">CLE -3.0</div>
                <div class="side-btn" onclick="pickSide(event,this,'MIL +3.0')">MIL +3.0</div>
                <div class="side-btn" onclick="pickSide(event,this,'OVER 220.5')">OVER</div>
                <div class="side-btn" onclick="pickSide(event,this,'UNDER 220.5')">UNDER</div>
            </div>
        </div>
        <div class="game-spread">CLE -3.0</div>
        <div class="game-total">O/U 220.5</div>
        <div class="game-grade"><span class="grade gb">B</span></div>
        <div class="game-edge"><span class="tag tag-trap">LINE CRASH</span> -8.5 to -3. Mitchell+Mobley OUT. Harden Q.</div>
    </div>
    <div class="game-detail">
        <div class="detail-grid">
            <div class="detail-box peter">
                <h4>Peter's Zone</h4>
                <p>Line crash from -8.5 to -3 screams value. CLE without Mitchell AND Mobley AND maybe Harden? MIL +3 is alive. Bucks 7-2 SU last 9 &mdash; Cam Thomas + Bobby Portis carrying. Lean MIL. Confirm Harden at game time.</p>
            </div>
            <div class="detail-box trends">
                <h4>Trends</h4>
                <ul>
                    <li>CLE 7-0 SU last 7 vs MIL (pre-injury news)</li>
                    <li>Line moved from -8.5 to -3 on injury news</li>
                    <li>MIL 7-2 SU last 9 without Giannis</li>
                    <li>Giannis OUT since Jan 23 (calf)</li>
                </ul>
            </div>
            <div class="detail-box flags">
                <h4>Flags</h4>
                <ul>
                    <li>Harden QUESTIONABLE (thumb fracture) &mdash; CONFIRM AT GAME TIME</li>
                    <li>Donovan Mitchell OUT (groin)</li>
                    <li>Evan Mobley OUT (calf)</li>
                    <li>If Harden sits, MIL +3 is the play</li>
                </ul>
            </div>
            <div class="detail-box chinny">
                <h4>Chinny's Props Zone</h4>
                <ul>
                    <li>Cam Thomas pts O 24.5 &mdash; carrying MIL</li>
                    <li>Bobby Portis pts+reb O 22.5</li>
                </ul>
            </div>
        </div>
    </div>
</div>

<!-- SAC @ HOU -->
<div class="game-row" data-game="SAC @ HOU" onclick="this.classList.toggle('expanded')">
    <div class="game-header">
        <div class="pick-check" onclick="togglePick(event, this, 'SAC @ HOU')"></div>
        <div class="game-time">8:00 ET</div>
        <div class="game-matchup"><span class="away">SAC</span> @ <span class="home">HOU</span>
            <div class="side-select">
                <div class="side-btn" onclick="pickSide(event,this,'SAC +14.0')">SAC +14.0</div>
                <div class="side-btn" onclick="pickSide(event,this,'HOU -14.0')">HOU -14.0</div>
                <div class="side-btn" onclick="pickSide(event,this,'OVER 222.5')">OVER</div>
                <div class="side-btn" onclick="pickSide(event,this,'UNDER 222.5')">UNDER</div>
            </div>
        </div>
        <div class="game-spread">HOU -14.0</div>
        <div class="game-total">O/U 222.5</div>
        <div class="game-grade"><span class="grade gbp">B+</span></div>
        <div class="game-edge"><span class="tag tag-trap">14!</span> UNDER 222.5 is the sharp play. Blowout = bench Q4.</div>
    </div>
    <div class="game-detail">
        <div class="detail-grid">
            <div class="detail-box peter">
                <h4>Peter's Zone</h4>
                <p>14 is massive but SAC literally has nobody. UNDER 222.5 is the sharper play &mdash; HOU defense + blowout = bench minutes Q4. Don't lay 14. SAC is 12-44. HOU UNDER 11 of last 12 home games.</p>
            </div>
            <div class="detail-box trends">
                <h4>Trends</h4>
                <ul>
                    <li>HOU UNDER 11 of last 12 home games</li>
                    <li>HOU defense elite &mdash; 109.4 PPG allowed</li>
                    <li>SAC 12-44. Sabonis + LaVine OUT for season</li>
                    <li>14 is season-high spread &mdash; blowouts often go UNDER</li>
                </ul>
            </div>
            <div class="detail-box flags">
                <h4>Flags</h4>
                <ul>
                    <li>14 is season-high spread &mdash; starters sit Q4</li>
                    <li>Blowout scenario = HOU holds back offense late</li>
                    <li>SAC: Sabonis OUT (meniscus), LaVine OUT (hand), Cardwell OUT</li>
                </ul>
            </div>
            <div class="detail-box chinny">
                <h4>Chinny's Props Zone</h4>
                <ul>
                    <li>Sengun pts+reb O 28.5 &mdash; HOU big advantage</li>
                    <li>HOU team total O 116.5 &mdash; SAC D is cooked</li>
                </ul>
            </div>
        </div>
    </div>
</div>

<!-- BOS @ DEN -->
<div class="game-row" data-game="BOS @ DEN" onclick="this.classList.toggle('expanded')">
    <div class="game-header">
        <div class="pick-check" onclick="togglePick(event, this, 'BOS @ DEN')"></div>
        <div class="game-time">10:00 ET</div>
        <div class="game-matchup"><span class="away">BOS</span> @ <span class="home">DEN</span>
            <div class="side-select">
                <div class="side-btn" onclick="pickSide(event,this,'BOS +3.5')">BOS +3.5</div>
                <div class="side-btn" onclick="pickSide(event,this,'DEN -3.5')">DEN -3.5</div>
                <div class="side-btn" onclick="pickSide(event,this,'OVER 228.5')">OVER</div>
                <div class="side-btn" onclick="pickSide(event,this,'UNDER 228.5')">UNDER</div>
            </div>
        </div>
        <div class="game-spread">DEN -3.5</div>
        <div class="game-total">O/U 228.5</div>
        <div class="game-grade"><span class="grade gbp">B+</span></div>
        <div class="game-edge"><span class="tag tag-upset">SHARP</span> BOS elite ATS on road as dog. DEN only 1-of-5 at home.</div>
    </div>
    <div class="game-detail">
        <div class="detail-grid">
            <div class="detail-box peter">
                <h4>Peter's Zone</h4>
                <p>BOS +3.5 is the sharp play. Boston's road ATS is elite &mdash; 8-2 last 10, 20-9-1 ATS on road, covered 8 of last 9 as underdogs. DEN only covering 1 of last 5 at Ball Arena (12-14 ATS at home). B2B + altitude is the only concern. BOS defense (107.6 PPG, 1st in league) neutralizes DEN offense. Take the points.</p>
            </div>
            <div class="detail-box trends">
                <h4>Trends</h4>
                <ul>
                    <li>BOS 8-2 ATS last 10 games</li>
                    <li>BOS 20-9-1 ATS on the road this season</li>
                    <li>BOS covered 8 of last 9 as underdogs</li>
                    <li>DEN 12-14 ATS at home &mdash; only 1-of-5 last 5</li>
                    <li>BOS #1 defense in NBA (107.6 PPG allowed)</li>
                </ul>
            </div>
            <div class="detail-box flags">
                <h4>Flags</h4>
                <ul>
                    <li>Brown QUESTIONABLE (knee) &mdash; expected to play</li>
                    <li>BOS on B2B at altitude &mdash; real concern</li>
                    <li>BOS covers as dogs at absurd rate this season</li>
                </ul>
            </div>
            <div class="detail-box chinny">
                <h4>Chinny's Props Zone</h4>
                <ul>
                    <li>Jokic pts+reb+ast O 45.5 &mdash; triple-double machine at home</li>
                    <li>Brown pts O 24.5 &mdash; if he plays</li>
                </ul>
            </div>
        </div>
    </div>
</div>

<!-- NBA UPSET SPECIALS -->
<div class="upset-section" id="upsetNBA">
    <div style="display:flex;justify-content:space-between;align-items:center;">
        <h3>Upset Specials (Peter's Territory)</h3>
        <div style="display:flex;gap:6px;">
            <button style="cursor:pointer;padding:4px 10px;border-radius:4px;background:rgba(212,160,23,0.15);color:#D4A017;font-size:11px;font-weight:700;border:none;" onclick="toggleUpsetEdit('NBA')">EDIT</button>
            <button style="cursor:pointer;padding:4px 10px;border-radius:4px;background:rgba(16,185,129,0.15);color:#10B981;font-size:11px;font-weight:700;border:none;" onclick="saveUpset('NBA')">SAVE</button>
        </div>
    </div>
    <div id="upsetNBADisplay"></div>
    <textarea id="upsetNBAEditor" style="display:none;width:100%;min-height:120px;background:#0D0D1A;color:#fff;border:1px solid #D4A017;border-radius:6px;padding:10px;font-family:'Nunito',sans-serif;font-size:13px;resize:vertical;margin-top:8px;" placeholder="One upset per line. Format: TEAM +SPREAD vs OPP | thesis"></textarea>
</div>

<!-- NBA PETER GUT PICKS (DYNAMIC) -->
<div class="input-section" id="peterGutNBA">
    <h3 id="peterGutNBATitle">Peter's Gut Picks &mdash; NBA</h3>
    <div id="peterGutNBAContent" style="font-size:13px;color:rgba(255,255,255,0.6);line-height:1.8;">
        <p style="color:rgba(255,255,255,0.3);font-style:italic;">Refresh slate or click NBA tab to load live gut picks from analysis...</p>
    </div>
    <div id="peterGutNBATimestamp" style="font-size:10px;color:rgba(255,255,255,0.2);margin-top:8px;"></div>
</div>

</div>

<!-- ===== NHL PANEL ===== -->
<div class="sport-panel" id="panel-nhl">

<div class="gotcha-banner">
    <h3 id="gotchaNHLTitle">Gotcha Card &mdash; NHL Feb 25 (First Night Back from Olympics)</h3>
    <ul>
        <li><span class="tag tag-rust">20-DAY BREAK</span> <strong>First games back from Olympics. Rust is the #1 variable for ALL 8 games.</strong></li>
        <li><strong>VGK missing FIVE key players</strong> &mdash; Eichel, Hanifin, Marner, Stone, Theodore all resting post-Olympics. Shell lineup vs LA. Biggest edge on the slate.</li>
        <li><strong>TBL 13-1-1 since Jan 1.</strong> Vasilevskiy 27-7-3, 2.11 GAA. Point + Hedman returning from Olympics. Hottest team in hockey.</li>
        <li><strong>WPG blue line decimated.</strong> Morrissey (IR), Pionk (week-to-week), Fleury (DTD) all out. Thin blue line at VAN.</li>
        <li><strong>VAN getting 4 players back tonight</strong> &mdash; Rossi, Boeser, Hoglander, Buium all returning. Major depth boost. VAN +110 has value.</li>
        <li><strong>COL best record in NHL (37-9-9).</strong> MacKinnon at 93 pts in 55 games. Kulak Avalanche debut tonight.</li>
        <li><strong>Trade deadline March 6</strong> &mdash; 9 days away. Bubble teams playing with extra urgency.</li>
        <li>WSH: Tom Wilson OUT (illness), John Carlson OUT (lower body). PHI +115 has value as small dog.</li>
    </ul>
</div>

<!-- PHI @ WSH -->
<div class="game-row" data-game="PHI @ WSH" onclick="this.classList.toggle('expanded')">
    <div class="game-header">
        <div class="pick-check" onclick="togglePick(event, this, 'PHI @ WSH')"></div>
        <div class="game-time">7:00 ET</div>
        <div class="game-matchup"><span class="away">PHI</span> @ <span class="home">WSH</span>
            <div class="side-select">
                <div class="side-btn" onclick="pickSide(event,this,'PHI ML +115')">PHI ML +115</div>
                <div class="side-btn" onclick="pickSide(event,this,'WSH ML -150')">WSH ML -150</div>
                <div class="side-btn" onclick="pickSide(event,this,'PHI +1.5')">PHI +1.5</div>
                <div class="side-btn" onclick="pickSide(event,this,'WSH -1.5')">WSH -1.5</div>
            </div>
        </div>
        <div class="game-spread">WSH -150 ML</div>
        <div class="game-total">TBD</div>
        <div class="game-grade"><span class="grade gb">B</span></div>
        <div class="game-edge"><span class="tag tag-upset">UPSET</span> <span class="tag tag-rust">RUST</span> WSH missing Wilson + Carlson. PHI +115 value.</div>
    </div>
    <div class="game-detail">
        <div class="detail-grid">
            <div class="detail-box peter">
                <h4>Peter's Zone</h4>
                <p>WSH at home but missing Wilson + Carlson hurts. PHI +115 has value. First game back, rust everywhere. Lean PHI ML as small dog. Connor McMichael activated for WSH.</p>
            </div>
            <div class="detail-box flags">
                <h4>Flags</h4>
                <ul>
                    <li>Tom Wilson OUT (illness)</li>
                    <li>John Carlson OUT (lower body)</li>
                    <li>Connor McMichael activated for WSH</li>
                    <li>First game back &mdash; rust applies both ways</li>
                </ul>
            </div>
        </div>
    </div>
</div>

<!-- BUF @ NJD -->
<div class="game-row" data-game="BUF @ NJD" onclick="this.classList.toggle('expanded')">
    <div class="game-header">
        <div class="pick-check" onclick="togglePick(event, this, 'BUF @ NJD')"></div>
        <div class="game-time">7:00 ET</div>
        <div class="game-matchup"><span class="away">BUF</span> @ <span class="home">NJD</span>
            <div class="side-select">
                <div class="side-btn" onclick="pickSide(event,this,'BUF ML -110')">BUF ML -110</div>
                <div class="side-btn" onclick="pickSide(event,this,'NJD ML -120')">NJD ML -120</div>
                <div class="side-btn" onclick="pickSide(event,this,'BUF +1.5')">BUF +1.5</div>
                <div class="side-btn" onclick="pickSide(event,this,'NJD -1.5')">NJD -1.5</div>
            </div>
        </div>
        <div class="game-spread">NJD -120 ML</div>
        <div class="game-total">TBD</div>
        <div class="game-grade"><span class="grade gbm">B-</span></div>
        <div class="game-edge"><span class="tag tag-rust">RUST</span> NJD 1-4-0 last 5 pre-break (1.6 GPG). BUF gets Luukkonen back.</div>
    </div>
    <div class="game-detail">
        <div class="detail-grid">
            <div class="detail-box peter">
                <h4>Peter's Zone</h4>
                <p>NJD offense was ice cold before the break &mdash; 1.6 GPG last 5 games. BUF getting Luukkonen back from IR is big. BUF ML lean. UNDER. Anton Wahlberg may make his NHL debut for BUF.</p>
            </div>
            <div class="detail-box flags">
                <h4>Flags</h4>
                <ul>
                    <li>BUF: Luukkonen activated off IR (big return)</li>
                    <li>BUF: Anton Wahlberg possible NHL debut</li>
                    <li>NJD 1-4-0 last 5 pre-break, averaging 1.6 GPG</li>
                    <li>UNDER lean &mdash; both teams rusty post-break</li>
                </ul>
            </div>
        </div>
    </div>
</div>

<!-- TOR @ TBL -->
<div class="game-row" data-game="TOR @ TBL" onclick="this.classList.toggle('expanded')">
    <div class="game-header">
        <div class="pick-check" onclick="togglePick(event, this, 'TOR @ TBL')"></div>
        <div class="game-time">7:30 ET</div>
        <div class="game-matchup"><span class="away">TOR</span> @ <span class="home">TBL</span>
            <div class="side-select">
                <div class="side-btn" onclick="pickSide(event,this,'TOR ML +180')">TOR ML +180</div>
                <div class="side-btn" onclick="pickSide(event,this,'TBL ML -230')">TBL ML -230</div>
                <div class="side-btn" onclick="pickSide(event,this,'TOR +1.5')">TOR +1.5</div>
                <div class="side-btn" onclick="pickSide(event,this,'TBL -1.5')">TBL -1.5</div>
            </div>
        </div>
        <div class="game-spread">TBL -230 ML</div>
        <div class="game-total">TBD</div>
        <div class="game-grade"><span class="grade gam">A-</span></div>
        <div class="game-edge"><span class="tag tag-home">TBL</span> 13-1-1 since Jan 1. Vasi 27-7-3. Point + Hedman back.</div>
    </div>
    <div class="game-detail">
        <div class="detail-grid">
            <div class="detail-box peter">
                <h4>Peter's Zone</h4>
                <p>Tampa is the best team in hockey right now. Vasilevskiy is a wall (27-7-3, 2.11 GAA). TBL ML is expensive (-230) but safe. TBL puck line -1.5 for value. Point + Hedman back from Olympics. Hedman has an assist in each of his last 8 Wednesday home games.</p>
            </div>
            <div class="detail-box trends">
                <h4>Trends</h4>
                <ul>
                    <li>TBL 13-1-1 since Jan 1 &mdash; hottest team in hockey</li>
                    <li>Vasilevskiy 27-7-3, 2.11 GAA, .922 SV%</li>
                    <li>Point + Hedman returning from Olympics</li>
                    <li>Hedman assist in last 8 Wednesday home games</li>
                </ul>
            </div>
            <div class="detail-box flags">
                <h4>Flags</h4>
                <ul>
                    <li>-230 is steep juice &mdash; puck line -1.5 is better value</li>
                    <li>TOR: Matthews in lineup, Dakota Joshua expected back</li>
                    <li>Confirm TOR starting goalie at game time</li>
                </ul>
            </div>
        </div>
    </div>
</div>

<!-- SEA @ DAL -->
<div class="game-row" data-game="SEA @ DAL" onclick="this.classList.toggle('expanded')">
    <div class="game-header">
        <div class="pick-check" onclick="togglePick(event, this, 'SEA @ DAL')"></div>
        <div class="game-time">8:00 ET</div>
        <div class="game-matchup"><span class="away">SEA</span> @ <span class="home">DAL</span>
            <div class="side-select">
                <div class="side-btn" onclick="pickSide(event,this,'SEA ML +140')">SEA ML +140</div>
                <div class="side-btn" onclick="pickSide(event,this,'DAL ML -170')">DAL ML -170</div>
                <div class="side-btn" onclick="pickSide(event,this,'SEA +1.5')">SEA +1.5</div>
                <div class="side-btn" onclick="pickSide(event,this,'DAL -1.5')">DAL -1.5</div>
            </div>
        </div>
        <div class="game-spread">DAL -170 ML</div>
        <div class="game-total">TBD</div>
        <div class="game-grade"><span class="grade gb">B</span></div>
        <div class="game-edge"><span class="tag tag-rust">RUST</span> DAL at home, better team. Standard home lean post-break.</div>
    </div>
    <div class="game-detail">
        <div class="detail-grid">
            <div class="detail-box peter">
                <h4>Peter's Zone</h4>
                <p>DAL at home, better team. Standard home lean post-break. No strong edge. Rust factor applies equally. No bet unless line moves.</p>
            </div>
        </div>
    </div>
</div>

<!-- COL @ UTA -->
<div class="game-row" data-game="COL @ UTA" onclick="this.classList.toggle('expanded')">
    <div class="game-header">
        <div class="pick-check" onclick="togglePick(event, this, 'COL @ UTA')"></div>
        <div class="game-time">9:00 ET</div>
        <div class="game-matchup"><span class="away">COL</span> @ <span class="home">UTA</span>
            <div class="side-select">
                <div class="side-btn" onclick="pickSide(event,this,'COL ML -125')">COL ML -125</div>
                <div class="side-btn" onclick="pickSide(event,this,'UTA ML +105')">UTA ML +105</div>
                <div class="side-btn" onclick="pickSide(event,this,'COL +1.5')">COL +1.5</div>
                <div class="side-btn" onclick="pickSide(event,this,'UTA -1.5')">UTA -1.5</div>
            </div>
        </div>
        <div class="game-spread">COL -125 ML</div>
        <div class="game-total">TBD</div>
        <div class="game-grade"><span class="grade gbp">B+</span></div>
        <div class="game-edge"><span class="tag tag-rust">RUST</span> COL best record in NHL. UTA 7-of-10 pre-break. Cooley possible return.</div>
    </div>
    <div class="game-detail">
        <div class="detail-grid">
            <div class="detail-box peter">
                <h4>Peter's Zone</h4>
                <p>COL is the class of the league (37-9-9) but UTA has been good &mdash; won 7 of 10 pre-break. COL ML lean but UTA +105 has value if Logan Cooley returns (missed 28 games). Brett Kulak makes Avalanche debut. MacKinnon at 93 pts in 55 games.</p>
            </div>
            <div class="detail-box flags">
                <h4>Flags</h4>
                <ul>
                    <li>Logan Cooley possible return (missed 28 games) &mdash; UTA boost</li>
                    <li>Brett Kulak Avalanche debut (acquired from PIT)</li>
                    <li>UTA: Won 7 of 10 pre-break. Home crowd will be electric</li>
                    <li>COL: Best record in NHL &mdash; 37-9-9, MacKinnon 93 pts</li>
                </ul>
            </div>
        </div>
    </div>
</div>

<!-- VGK @ LAK -->
<div class="game-row" data-game="VGK @ LAK" onclick="this.classList.toggle('expanded')">
    <div class="game-header">
        <div class="pick-check" onclick="togglePick(event, this, 'VGK @ LAK')"></div>
        <div class="game-time">10:00 ET</div>
        <div class="game-matchup"><span class="away">VGK</span> @ <span class="home">LAK</span>
            <div class="side-select">
                <div class="side-btn" onclick="pickSide(event,this,'VGK ML +135')">VGK ML +135</div>
                <div class="side-btn" onclick="pickSide(event,this,'LAK ML -160')">LAK ML -160</div>
                <div class="side-btn" onclick="pickSide(event,this,'VGK +1.5')">VGK +1.5</div>
                <div class="side-btn" onclick="pickSide(event,this,'LAK -1.5')">LAK -1.5</div>
            </div>
        </div>
        <div class="game-spread">LAK -160 ML</div>
        <div class="game-total">TBD</div>
        <div class="game-grade"><span class="grade ga">A</span></div>
        <div class="game-edge"><span class="tag tag-home">SMASH</span> VGK missing 5 starters. LAK at home. Biggest NHL edge.</div>
    </div>
    <div class="game-detail">
        <div class="detail-grid">
            <div class="detail-box peter">
                <h4>Peter's Zone</h4>
                <p>This is the biggest edge on the NHL slate. VGK is a shell team tonight &mdash; missing Eichel, Hanifin, Marner, Stone, AND Theodore. All held out post-Olympics. LAK at home vs a depleted VGK. LAK ML is the smash. LAK puck line -1.5 for value.</p>
            </div>
            <div class="detail-box flags">
                <h4>Flags</h4>
                <ul>
                    <li>VGK OUT: Eichel, Hanifin, Marner, Stone, Theodore &mdash; all 5 resting</li>
                    <li>VGK shell lineup &mdash; not a real Vegas team tonight</li>
                    <li>LAK at home, full healthy roster</li>
                    <li>Grade A &mdash; highest confidence NHL play on the slate</li>
                </ul>
            </div>
        </div>
    </div>
</div>

<!-- WPG @ VAN -->
<div class="game-row" data-game="WPG @ VAN" onclick="this.classList.toggle('expanded')">
    <div class="game-header">
        <div class="pick-check" onclick="togglePick(event, this, 'WPG @ VAN')"></div>
        <div class="game-time">10:00 ET</div>
        <div class="game-matchup"><span class="away">WPG</span> @ <span class="home">VAN</span>
            <div class="side-select">
                <div class="side-btn" onclick="pickSide(event,this,'WPG ML -130')">WPG ML -130</div>
                <div class="side-btn" onclick="pickSide(event,this,'VAN ML +110')">VAN ML +110</div>
                <div class="side-btn" onclick="pickSide(event,this,'WPG +1.5')">WPG +1.5</div>
                <div class="side-btn" onclick="pickSide(event,this,'VAN -1.5')">VAN -1.5</div>
            </div>
        </div>
        <div class="game-spread">WPG -130 ML</div>
        <div class="game-total">TBD</div>
        <div class="game-grade"><span class="grade gbp">B+</span></div>
        <div class="game-edge"><span class="tag tag-upset">UPSET</span> WPG blue line gutted. VAN gets 4 players back at home.</div>
    </div>
    <div class="game-detail">
        <div class="detail-grid">
            <div class="detail-box peter">
                <h4>Peter's Zone</h4>
                <p>WPG is favored but their blue line is gutted &mdash; Morrissey (IR), Pionk (week-to-week), Fleury (DTD). VAN getting back Rossi, Boeser, Hoglander, AND Buium tonight. VAN +110 is the play. Matchup swings hard to VAN at home.</p>
            </div>
            <div class="detail-box flags">
                <h4>Flags</h4>
                <ul>
                    <li>WPG OUT: Morrissey (IR), Pionk (W2W), Fleury (DTD) &mdash; decimated D</li>
                    <li>VAN returning: Rossi, Boeser, Hoglander, Buium &mdash; 4 players back</li>
                    <li>VAN at home &mdash; crowd factor</li>
                    <li>Matchup advantage shifts heavily to VAN tonight</li>
                </ul>
            </div>
        </div>
    </div>
</div>

<!-- EDM @ ANA -->
<div class="game-row" data-game="EDM @ ANA" onclick="this.classList.toggle('expanded')">
    <div class="game-header">
        <div class="pick-check" onclick="togglePick(event, this, 'EDM @ ANA')"></div>
        <div class="game-time">10:30 ET</div>
        <div class="game-matchup"><span class="away">EDM</span> @ <span class="home">ANA</span>
            <div class="side-select">
                <div class="side-btn" onclick="pickSide(event,this,'EDM ML -125')">EDM ML -125</div>
                <div class="side-btn" onclick="pickSide(event,this,'ANA ML +105')">ANA ML +105</div>
                <div class="side-btn" onclick="pickSide(event,this,'EDM +1.5')">EDM +1.5</div>
                <div class="side-btn" onclick="pickSide(event,this,'ANA -1.5')">ANA -1.5</div>
            </div>
        </div>
        <div class="game-spread">EDM -125 ML</div>
        <div class="game-total">TBD</div>
        <div class="game-grade"><span class="grade gb">B</span></div>
        <div class="game-edge"><span class="tag tag-rust">RUST</span> EDM 3-game losing streak pre-break. McDavid back as Olympic MVP.</div>
    </div>
    <div class="game-detail">
        <div class="detail-grid">
            <div class="detail-box peter">
                <h4>Peter's Zone</h4>
                <p>McDavid motivated after winning Olympic MVP but Oilers were cold pre-break (3-game losing streak). EDM ML lean but ANA +105 is interesting with Leo Carlsson returning (missed 5 weeks). Sennecke having a great season.</p>
            </div>
            <div class="detail-box flags">
                <h4>Flags</h4>
                <ul>
                    <li>EDM: 3-game losing streak pre-break</li>
                    <li>McDavid returning as Olympic MVP &mdash; motivated</li>
                    <li>ANA: Leo Carlsson returning (missed 5 weeks)</li>
                    <li>ANA: Sennecke having strong season</li>
                </ul>
            </div>
        </div>
    </div>
</div>

<!-- NHL UPSET SPECIALS -->
<div class="upset-section" id="upsetNHL">
    <div style="display:flex;justify-content:space-between;align-items:center;">
        <h3>Upset Specials (Peter + Chinny)</h3>
        <div style="display:flex;gap:6px;">
            <button style="cursor:pointer;padding:4px 10px;border-radius:4px;background:rgba(212,160,23,0.15);color:#D4A017;font-size:11px;font-weight:700;border:none;" onclick="toggleUpsetEdit('NHL')">EDIT</button>
            <button style="cursor:pointer;padding:4px 10px;border-radius:4px;background:rgba(16,185,129,0.15);color:#10B981;font-size:11px;font-weight:700;border:none;" onclick="saveUpset('NHL')">SAVE</button>
        </div>
    </div>
    <div id="upsetNHLDisplay"></div>
    <textarea id="upsetNHLEditor" style="display:none;width:100%;min-height:120px;background:#0D0D1A;color:#fff;border:1px solid #D4A017;border-radius:6px;padding:10px;font-family:'Nunito',sans-serif;font-size:13px;resize:vertical;margin-top:8px;" placeholder="One upset per line. Format: TEAM +SPREAD vs OPP | thesis"></textarea>
</div>

<!-- NHL PETER + CHINNY INPUT -->
<div class="input-section" style="border-color:rgba(16,185,129,0.25);background:rgba(16,185,129,0.04);">
    <h3 style="color:#10B981;">Chinny's NHL Call</h3>
    <p>
        NHL is Chinny's card. Peter's top NHL picks:<br>
        1. <strong>LAK ML vs VGK</strong> &mdash; VGK missing 5 starters. Biggest NHL edge. Grade A.<br>
        2. <strong>VAN +110 vs WPG</strong> &mdash; WPG blue line decimated. VAN 4 players back at home. Grade B+.<br>
        3. <strong>TBL puck line -1.5 vs TOR</strong> &mdash; Hottest team in hockey. Vasi is a wall. Better value than ML.<br>
        4. Goalie confirmations needed for ALL 8 games before lock.<br>
        5. Olympic break rust applies across the board &mdash; favor home ice.<br>
        6. UNDER lean for first night back &mdash; lower pace, both teams rusty.
    </p>
</div>

<!-- NHL PETER GUT PICKS (DYNAMIC) -->
<div class="input-section" id="peterGutNHL">
    <h3 id="peterGutNHLTitle">Peter's Gut Picks &mdash; NHL</h3>
    <div id="peterGutNHLContent" style="font-size:13px;color:rgba(255,255,255,0.6);line-height:1.8;">
        <p style="color:rgba(255,255,255,0.3);font-style:italic;">Refresh slate or click NHL tab to load live gut picks from analysis...</p>
    </div>
    <div id="peterGutNHLTimestamp" style="font-size:10px;color:rgba(255,255,255,0.2);margin-top:8px;"></div>
</div>

</div>

<!-- ===== SOCCER PANEL ===== -->
<div class="sport-panel" id="panel-soccer">
<div class="gotcha-banner" style="border-color:rgba(16,185,129,0.2);background:rgba(16,185,129,0.06);">
    <h3 style="color:#10B981;">Soccer — Live Lines (Hard Rock Bet)</h3>
    <p style="color:rgba(255,255,255,0.5);font-size:13px;">MLS, EPL, Champions League, La Liga. Moneylines + totals. No player props.</p>
</div>
<div class="empty-state">No games on the slate.<br><strong>Hit REFRESH SLATE</strong> to check for live lines.</div>
</div>

<!-- ===== MMA PANEL ===== -->
<div class="sport-panel" id="panel-mma">
<div class="gotcha-banner" style="border-color:rgba(239,68,68,0.2);background:rgba(239,68,68,0.06);">
    <h3 style="color:#EF4444;">MMA / UFC — Live Lines (Hard Rock Bet)</h3>
    <p style="color:rgba(255,255,255,0.5);font-size:13px;">Moneylines + totals (rounds). Fight night data.</p>
</div>
<div class="empty-state">No fights on the slate.<br><strong>Hit REFRESH SLATE</strong> to check for live lines.</div>
</div>

<!-- ===== BOXING PANEL ===== -->
<div class="sport-panel" id="panel-boxing">
<div class="gotcha-banner" style="border-color:rgba(168,85,247,0.2);background:rgba(168,85,247,0.06);">
    <h3 style="color:#A855F7;">Boxing — Live Lines (Hard Rock Bet)</h3>
    <p style="color:rgba(255,255,255,0.5);font-size:13px;">Moneylines + totals (rounds).</p>
</div>
<div class="empty-state">No fights on the slate.<br><strong>Hit REFRESH SLATE</strong> to check for live lines.</div>
</div>

<!-- ===== PROPS PANEL (Chinny's Card) ===== -->
<div class="sport-panel" id="panel-props">

<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
    <div style="font-size:11px;color:rgba(255,255,255,0.25);" id="propsTimestamp">Last updated: Feb 27, 2026 — 2:30 PM ET</div>
</div>

<div class="gotcha-banner" style="border-color:rgba(16,185,129,0.2);background:rgba(16,185,129,0.06);">
    <h3 style="color:#10B981;">Chinny's Props Card</h3>
    <ul>
        <li><strong>Props are Chinny's territory.</strong> Top 5 per game. B or higher only.</li>
        <li>Blowout filter: if the game is projected 15+ margin, prop volume drops (starters sit).</li>
        <li>Streak data must be verified for CURRENT TEAM context (learned from Harden mistake).</li>
        <li>NHL props TBD until goalie confirmations at noon.</li>
    </ul>
</div>

<!-- CLE @ MIL Props -->
<div style="background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.06);border-radius:12px;padding:16px 20px;margin-bottom:12px;">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
        <div><span class="tag" style="background:rgba(200,50,50,0.2);color:#E25555;">NBA</span> <strong style="font-family:'Playfair Display',serif;">CLE @ MIL</strong> <span style="font-size:12px;color:rgba(255,255,255,0.3);">8:00 ET</span></div>
        <span class="grade gam">A-</span>
    </div>
    <table style="width:100%;border-collapse:collapse;">
    <tr><th style="text-align:left;padding:6px 8px;font-size:10px;color:#10B981;text-transform:uppercase;letter-spacing:1px;">Player</th><th style="text-align:left;padding:6px 8px;font-size:10px;color:#10B981;">Prop</th><th style="text-align:left;padding:6px 8px;font-size:10px;color:#10B981;">Line</th><th style="text-align:center;padding:6px 8px;font-size:10px;color:#10B981;">Grade</th><th style="text-align:left;padding:6px 8px;font-size:10px;color:#10B981;">Why</th></tr>
    <tr style="border-bottom:1px solid rgba(255,255,255,0.04);"><td style="padding:8px;font-size:13px;">Mitchell</td><td style="padding:8px;font-size:13px;">Pts</td><td style="padding:8px;font-size:13px;color:#D4A017;font-weight:700;">O 24.5</td><td style="text-align:center;"><span class="grade ga">A</span></td><td style="padding:8px;font-size:12px;color:rgba(255,255,255,0.5);">25+ in 8 straight vs MIL defense</td></tr>
    <tr style="border-bottom:1px solid rgba(255,255,255,0.04);"><td style="padding:8px;font-size:13px;">Harden</td><td style="padding:8px;font-size:13px;">Ast</td><td style="padding:8px;font-size:13px;color:#D4A017;font-weight:700;">O 7.5</td><td style="text-align:center;"><span class="grade gb">B</span></td><td style="padding:8px;font-size:12px;color:rgba(255,255,255,0.5);">IF he plays (B2B). CLE system feeds assists.</td></tr>
    <tr style="border-bottom:1px solid rgba(255,255,255,0.04);"><td style="padding:8px;font-size:13px;">Allen</td><td style="padding:8px;font-size:13px;">Reb</td><td style="padding:8px;font-size:13px;color:#D4A017;font-weight:700;">O 10.5</td><td style="text-align:center;"><span class="grade gb">B</span></td><td style="padding:8px;font-size:12px;color:rgba(255,255,255,0.5);">No Giannis = weak MIL boards</td></tr>
    <tr style="border-bottom:1px solid rgba(255,255,255,0.04);"><td style="padding:8px;font-size:13px;">Dame</td><td style="padding:8px;font-size:13px;">Pts</td><td style="padding:8px;font-size:13px;color:#D4A017;font-weight:700;">O 26.5</td><td style="text-align:center;"><span class="grade gb">B</span></td><td style="padding:8px;font-size:12px;color:rgba(255,255,255,0.5);">Has to carry MIL alone. 20+ shots.</td></tr>
    <tr><td style="padding:8px;font-size:13px;">Mobley</td><td style="padding:8px;font-size:13px;">Pts+Reb</td><td style="padding:8px;font-size:13px;color:#D4A017;font-weight:700;">O 22.5</td><td style="text-align:center;"><span class="grade gb">B</span></td><td style="padding:8px;font-size:12px;color:rgba(255,255,255,0.5);">Matchup advantage in paint vs MIL.</td></tr>
    </table>
</div>

<!-- OKC @ DET Props -->
<div style="background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.06);border-radius:12px;padding:16px 20px;margin-bottom:12px;">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
        <div><span class="tag" style="background:rgba(200,50,50,0.2);color:#E25555;">NBA</span> <strong style="font-family:'Playfair Display',serif;">OKC @ DET</strong> <span style="font-size:12px;color:rgba(255,255,255,0.3);">7:30 ET</span></div>
        <span class="grade gbp">B+</span>
    </div>
    <table style="width:100%;border-collapse:collapse;">
    <tr><th style="text-align:left;padding:6px 8px;font-size:10px;color:#10B981;text-transform:uppercase;letter-spacing:1px;">Player</th><th style="text-align:left;padding:6px 8px;font-size:10px;color:#10B981;">Prop</th><th style="text-align:left;padding:6px 8px;font-size:10px;color:#10B981;">Line</th><th style="text-align:center;padding:6px 8px;font-size:10px;color:#10B981;">Grade</th><th style="text-align:left;padding:6px 8px;font-size:10px;color:#10B981;">Why</th></tr>
    <tr style="border-bottom:1px solid rgba(255,255,255,0.04);"><td style="padding:8px;font-size:13px;">Cade</td><td style="padding:8px;font-size:13px;">Pts</td><td style="padding:8px;font-size:13px;color:#D4A017;font-weight:700;">O 26.5</td><td style="text-align:center;"><span class="grade ga">A</span></td><td style="padding:8px;font-size:12px;color:rgba(255,255,255,0.5);">OKC shell. Cade showcase at home.</td></tr>
    <tr style="border-bottom:1px solid rgba(255,255,255,0.04);"><td style="padding:8px;font-size:13px;">Cade</td><td style="padding:8px;font-size:13px;">Ast</td><td style="padding:8px;font-size:13px;color:#D4A017;font-weight:700;">O 8.5</td><td style="text-align:center;"><span class="grade gb">B</span></td><td style="padding:8px;font-size:12px;color:rgba(255,255,255,0.5);">OKC can't guard PnR without SGA/Williams.</td></tr>
    <tr style="border-bottom:1px solid rgba(255,255,255,0.04);"><td style="padding:8px;font-size:13px;">Ivey</td><td style="padding:8px;font-size:13px;">Pts</td><td style="padding:8px;font-size:13px;color:#D4A017;font-weight:700;">O 18.5</td><td style="text-align:center;"><span class="grade gb">B</span></td><td style="padding:8px;font-size:12px;color:rgba(255,255,255,0.5);">DET rolling. Ivey eats vs depleted backcourt.</td></tr>
    <tr style="border-bottom:1px solid rgba(255,255,255,0.04);"><td style="padding:8px;font-size:13px;">Duren</td><td style="padding:8px;font-size:13px;">Reb</td><td style="padding:8px;font-size:13px;color:#D4A017;font-weight:700;">O 10.5</td><td style="text-align:center;"><span class="grade gb">B</span></td><td style="padding:8px;font-size:12px;color:rgba(255,255,255,0.5);">OKC without Chet = no rim presence.</td></tr>
    <tr><td style="padding:8px;font-size:13px;">OKC TT</td><td style="padding:8px;font-size:13px;">Under</td><td style="padding:8px;font-size:13px;color:#D4A017;font-weight:700;">U 105.5</td><td style="text-align:center;"><span class="grade gb">B</span></td><td style="padding:8px;font-size:12px;color:rgba(255,255,255,0.5);">Who scores for OKC? Nobody.</td></tr>
    </table>
</div>

<!-- SA @ TOR Props -->
<div style="background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.06);border-radius:12px;padding:16px 20px;margin-bottom:12px;">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
        <div><span class="tag" style="background:rgba(200,50,50,0.2);color:#E25555;">NBA</span> <strong style="font-family:'Playfair Display',serif;">SA @ TOR</strong> <span style="font-size:12px;color:rgba(255,255,255,0.3);">7:30 ET</span></div>
        <span class="grade gb">B</span>
    </div>
    <table style="width:100%;border-collapse:collapse;">
    <tr><th style="text-align:left;padding:6px 8px;font-size:10px;color:#10B981;text-transform:uppercase;letter-spacing:1px;">Player</th><th style="text-align:left;padding:6px 8px;font-size:10px;color:#10B981;">Prop</th><th style="text-align:left;padding:6px 8px;font-size:10px;color:#10B981;">Line</th><th style="text-align:center;padding:6px 8px;font-size:10px;color:#10B981;">Grade</th><th style="text-align:left;padding:6px 8px;font-size:10px;color:#10B981;">Why</th></tr>
    <tr style="border-bottom:1px solid rgba(255,255,255,0.04);"><td style="padding:8px;font-size:13px;">Wemby</td><td style="padding:8px;font-size:13px;">Pts</td><td style="padding:8px;font-size:13px;color:#D4A017;font-weight:700;">O 24.5</td><td style="text-align:center;"><span class="grade ga">A</span></td><td style="padding:8px;font-size:12px;color:rgba(255,255,255,0.5);">IF he plays. TOR has no answer for him.</td></tr>
    <tr style="border-bottom:1px solid rgba(255,255,255,0.04);"><td style="padding:8px;font-size:13px;">Wemby</td><td style="padding:8px;font-size:13px;">Blk</td><td style="padding:8px;font-size:13px;color:#D4A017;font-weight:700;">O 2.5</td><td style="text-align:center;"><span class="grade gb">B</span></td><td style="padding:8px;font-size:12px;color:rgba(255,255,255,0.5);">TOR attacks rim. Wemby is the wall.</td></tr>
    <tr style="border-bottom:1px solid rgba(255,255,255,0.04);"><td style="padding:8px;font-size:13px;">Barnes</td><td style="padding:8px;font-size:13px;">Pts</td><td style="padding:8px;font-size:13px;color:#D4A017;font-weight:700;">O 22.5</td><td style="text-align:center;"><span class="grade gb">B</span></td><td style="padding:8px;font-size:12px;color:rgba(255,255,255,0.5);">Scottie competes. Home game energy.</td></tr>
    <tr style="border-bottom:1px solid rgba(255,255,255,0.04);"><td style="padding:8px;font-size:13px;">Barnes</td><td style="padding:8px;font-size:13px;">Reb</td><td style="padding:8px;font-size:13px;color:#D4A017;font-weight:700;">O 7.5</td><td style="text-align:center;"><span class="grade gb">B</span></td><td style="padding:8px;font-size:12px;color:rgba(255,255,255,0.5);">SA doesn't box out well on wings.</td></tr>
    <tr><td style="padding:8px;font-size:13px;">Vassell</td><td style="padding:8px;font-size:13px;">Pts</td><td style="padding:8px;font-size:13px;color:#D4A017;font-weight:700;">O 17.5</td><td style="text-align:center;"><span class="grade gbm">B-</span></td><td style="padding:8px;font-size:12px;color:rgba(255,255,255,0.5);">Secondary scorer if Wemby draws doubles.</td></tr>
    </table>
</div>

<!-- SAC @ HOU Props -->
<div style="background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.06);border-radius:12px;padding:16px 20px;margin-bottom:12px;">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
        <div><span class="tag" style="background:rgba(200,50,50,0.2);color:#E25555;">NBA</span> <strong style="font-family:'Playfair Display',serif;">SAC @ HOU</strong> <span style="font-size:12px;color:rgba(255,255,255,0.3);">8:00 ET</span></div>
        <span class="grade gbp">B+</span>
    </div>
    <table style="width:100%;border-collapse:collapse;">
    <tr><th style="text-align:left;padding:6px 8px;font-size:10px;color:#10B981;text-transform:uppercase;letter-spacing:1px;">Player</th><th style="text-align:left;padding:6px 8px;font-size:10px;color:#10B981;">Prop</th><th style="text-align:left;padding:6px 8px;font-size:10px;color:#10B981;">Line</th><th style="text-align:center;padding:6px 8px;font-size:10px;color:#10B981;">Grade</th><th style="text-align:left;padding:6px 8px;font-size:10px;color:#10B981;">Why</th></tr>
    <tr style="border-bottom:1px solid rgba(255,255,255,0.04);"><td style="padding:8px;font-size:13px;">Sengun</td><td style="padding:8px;font-size:13px;">Pts+Reb</td><td style="padding:8px;font-size:13px;color:#D4A017;font-weight:700;">O 28.5</td><td style="text-align:center;"><span class="grade gb">B</span></td><td style="padding:8px;font-size:12px;color:rgba(255,255,255,0.5);">HOU big advantage. SAC tired bigs.</td></tr>
    <tr style="border-bottom:1px solid rgba(255,255,255,0.04);"><td style="padding:8px;font-size:13px;">Fox</td><td style="padding:8px;font-size:13px;">Pts</td><td style="padding:8px;font-size:13px;color:#D4A017;font-weight:700;">U 24.5</td><td style="text-align:center;"><span class="grade gb">B</span></td><td style="padding:8px;font-size:12px;color:rgba(255,255,255,0.5);">B2B legs. HOU elite perimeter D.</td></tr>
    <tr style="border-bottom:1px solid rgba(255,255,255,0.04);"><td style="padding:8px;font-size:13px;">Jalen Green</td><td style="padding:8px;font-size:13px;">Pts</td><td style="padding:8px;font-size:13px;color:#D4A017;font-weight:700;">O 20.5</td><td style="text-align:center;"><span class="grade gb">B</span></td><td style="padding:8px;font-size:12px;color:rgba(255,255,255,0.5);">SAC D is cooked on B2B. Green eats.</td></tr>
    <tr style="border-bottom:1px solid rgba(255,255,255,0.04);"><td style="padding:8px;font-size:13px;">Sabonis</td><td style="padding:8px;font-size:13px;">Reb</td><td style="padding:8px;font-size:13px;color:#D4A017;font-weight:700;">O 11.5</td><td style="text-align:center;"><span class="grade gbm">B-</span></td><td style="padding:8px;font-size:12px;color:rgba(255,255,255,0.5);">Sabonis always boards. But tired legs risk.</td></tr>
    <tr><td style="padding:8px;font-size:13px;">HOU TT</td><td style="padding:8px;font-size:13px;">Over</td><td style="padding:8px;font-size:13px;color:#D4A017;font-weight:700;">O 118.5</td><td style="text-align:center;"><span class="grade gb">B</span></td><td style="padding:8px;font-size:12px;color:rgba(255,255,255,0.5);">SAC defense on B2B = layup line.</td></tr>
    </table>
</div>

<!-- BOS @ DEN Props -->
<div style="background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.06);border-radius:12px;padding:16px 20px;margin-bottom:12px;">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
        <div><span class="tag" style="background:rgba(200,50,50,0.2);color:#E25555;">NBA</span> <strong style="font-family:'Playfair Display',serif;">BOS @ DEN</strong> <span style="font-size:12px;color:rgba(255,255,255,0.3);">10:00 ET</span></div>
        <span class="grade gb">B</span>
    </div>
    <table style="width:100%;border-collapse:collapse;">
    <tr><th style="text-align:left;padding:6px 8px;font-size:10px;color:#10B981;text-transform:uppercase;letter-spacing:1px;">Player</th><th style="text-align:left;padding:6px 8px;font-size:10px;color:#10B981;">Prop</th><th style="text-align:left;padding:6px 8px;font-size:10px;color:#10B981;">Line</th><th style="text-align:center;padding:6px 8px;font-size:10px;color:#10B981;">Grade</th><th style="text-align:left;padding:6px 8px;font-size:10px;color:#10B981;">Why</th></tr>
    <tr style="border-bottom:1px solid rgba(255,255,255,0.04);"><td style="padding:8px;font-size:13px;">Jokic</td><td style="padding:8px;font-size:13px;">Pts+Reb+Ast</td><td style="padding:8px;font-size:13px;color:#D4A017;font-weight:700;">O 45.5</td><td style="text-align:center;"><span class="grade ga">A</span></td><td style="padding:8px;font-size:12px;color:rgba(255,255,255,0.5);">Triple-double machine at home. BOS no bigs.</td></tr>
    <tr style="border-bottom:1px solid rgba(255,255,255,0.04);"><td style="padding:8px;font-size:13px;">Jokic</td><td style="padding:8px;font-size:13px;">Reb</td><td style="padding:8px;font-size:13px;color:#D4A017;font-weight:700;">O 12.5</td><td style="text-align:center;"><span class="grade ga">A</span></td><td style="padding:8px;font-size:12px;color:rgba(255,255,255,0.5);">BOS has zero rim protection without KP/Tatum.</td></tr>
    <tr style="border-bottom:1px solid rgba(255,255,255,0.04);"><td style="padding:8px;font-size:13px;">Murray</td><td style="padding:8px;font-size:13px;">Pts</td><td style="padding:8px;font-size:13px;color:#D4A017;font-weight:700;">O 21.5</td><td style="text-align:center;"><span class="grade gb">B</span></td><td style="padding:8px;font-size:12px;color:rgba(255,255,255,0.5);">BOS B2B backcourt defense = slower rotations.</td></tr>
    <tr style="border-bottom:1px solid rgba(255,255,255,0.04);"><td style="padding:8px;font-size:13px;">BOS TT</td><td style="padding:8px;font-size:13px;">Under</td><td style="padding:8px;font-size:13px;color:#D4A017;font-weight:700;">U 108.5</td><td style="text-align:center;"><span class="grade gb">B</span></td><td style="padding:8px;font-size:12px;color:rgba(255,255,255,0.5);">No Tatum, Brown questionable. Who scores?</td></tr>
    <tr><td style="padding:8px;font-size:13px;">MPJ</td><td style="padding:8px;font-size:13px;">Pts</td><td style="padding:8px;font-size:13px;color:#D4A017;font-weight:700;">O 17.5</td><td style="text-align:center;"><span class="grade gbm">B-</span></td><td style="padding:8px;font-size:12px;color:rgba(255,255,255,0.5);">BOS can't rotate on B2B. MPJ open looks.</td></tr>
    </table>
</div>

<!-- GS @ MEM Props -->
<div style="background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.06);border-radius:12px;padding:16px 20px;margin-bottom:12px;">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
        <div><span class="tag" style="background:rgba(200,50,50,0.2);color:#E25555;">NBA</span> <strong style="font-family:'Playfair Display',serif;">GS @ MEM</strong> <span style="font-size:12px;color:rgba(255,255,255,0.3);">7:30 ET</span></div>
        <span class="grade gc">C</span>
    </div>
    <table style="width:100%;border-collapse:collapse;">
    <tr><th style="text-align:left;padding:6px 8px;font-size:10px;color:#10B981;text-transform:uppercase;letter-spacing:1px;">Player</th><th style="text-align:left;padding:6px 8px;font-size:10px;color:#10B981;">Prop</th><th style="text-align:left;padding:6px 8px;font-size:10px;color:#10B981;">Line</th><th style="text-align:center;padding:6px 8px;font-size:10px;color:#10B981;">Grade</th><th style="text-align:left;padding:6px 8px;font-size:10px;color:#10B981;">Why</th></tr>
    <tr style="border-bottom:1px solid rgba(255,255,255,0.04);"><td style="padding:8px;font-size:13px;">Ja</td><td style="padding:8px;font-size:13px;">Pts</td><td style="padding:8px;font-size:13px;color:#D4A017;font-weight:700;">O 24.5</td><td style="text-align:center;"><span class="grade gb">B</span></td><td style="padding:8px;font-size:12px;color:rgba(255,255,255,0.5);">If Ja plays. GS no perimeter D without Curry.</td></tr>
    <tr style="border-bottom:1px solid rgba(255,255,255,0.04);"><td style="padding:8px;font-size:13px;">Ja</td><td style="padding:8px;font-size:13px;">Ast</td><td style="padding:8px;font-size:13px;color:#D4A017;font-weight:700;">O 7.5</td><td style="text-align:center;"><span class="grade gb">B</span></td><td style="padding:8px;font-size:12px;color:rgba(255,255,255,0.5);">GS depleted = easy lanes to kick out.</td></tr>
    <tr style="border-bottom:1px solid rgba(255,255,255,0.04);"><td style="padding:8px;font-size:13px;">JJJ</td><td style="padding:8px;font-size:13px;">Reb</td><td style="padding:8px;font-size:13px;color:#D4A017;font-weight:700;">O 6.5</td><td style="text-align:center;"><span class="grade gbm">B-</span></td><td style="padding:8px;font-size:12px;color:rgba(255,255,255,0.5);">GS thin frontcourt. JJJ cleans glass.</td></tr>
    <tr><td style="padding:8px;font-size:13px;" colspan="5" style="color:rgba(255,255,255,0.3);font-style:italic;font-size:12px;padding:8px;">Line suspicious. Verify before props lock. Game grade C = limited props confidence.</td></tr>
    </table>
</div>

<p class="note" style="margin-top:16px;">NHL props locked after goalie confirmations at noon. Chinny reviews all props before lock.</p>
<div id="propsBottomTimestamp" style="text-align:right;font-size:10px;color:rgba(255,255,255,0.2);margin-top:12px;">Props card generated: Feb 27, 2026 — 2:30 PM ET | Next update: before tip-off</div>

</div>

<!-- ===== COMBINED PANEL ===== -->
<div class="sport-panel" id="panel-combined">

<div class="combined-header">
    <h2 id="combinedTitle">Full Slate</h2>
    <div class="combined-stat" id="combinedStats">
        <div class="stat-pill">Loading...</div>
    </div>
</div>
<div style="font-size:11px;color:rgba(255,255,255,0.25);margin-bottom:12px;" id="combinedTimestamp">Waiting for data...</div>

<div id="combinedTableContainer">
    <div style="text-align:center;padding:40px;color:rgba(255,255,255,0.4);">Click to load or hit REFRESH SLATE</div>
</div>

</div>

<!-- ===== SUBMIT PICK PANEL ===== -->
<!-- ===== BANKROLL PANEL ===== -->
<div class="sport-panel" id="panel-bankroll">
<div class="pick-form">
    <h2 style="color:#D4A017;">Bankroll Tracker</h2>
    <div class="form-sub">Track every pick. Know where you stand.</div>

    <!-- Bankroll settings -->
    <div style="display:flex;gap:12px;margin:16px 0;">
        <div class="form-group" style="flex:1;">
            <label>Starting Bankroll ($)</label>
            <input type="number" id="bankrollStart" placeholder="1000" value="">
        </div>
        <div class="form-group" style="flex:1;">
            <label>Unit Size ($)</label>
            <input type="number" id="unitSize" placeholder="25" value="">
        </div>
        <div style="flex:0 0 auto;display:flex;align-items:flex-end;">
            <button class="submit-pick-btn" onclick="saveBankrollSettings()" style="padding:10px 20px;">Save</button>
        </div>
    </div>

    <!-- Summary cards -->
    <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin:16px 0;">
        <div style="background:#141428;border:1px solid #1e1e40;border-radius:8px;padding:14px;text-align:center;">
            <div style="color:rgba(255,255,255,0.5);font-size:11px;text-transform:uppercase;">Current Balance</div>
            <div id="brBalance" style="color:#D4A017;font-size:24px;font-weight:800;">$0</div>
        </div>
        <div style="background:#141428;border:1px solid #1e1e40;border-radius:8px;padding:14px;text-align:center;">
            <div style="color:rgba(255,255,255,0.5);font-size:11px;text-transform:uppercase;">Record (W-L-P)</div>
            <div id="brRecord" style="color:#fff;font-size:24px;font-weight:800;">0-0-0</div>
        </div>
        <div style="background:#141428;border:1px solid #1e1e40;border-radius:8px;padding:14px;text-align:center;">
            <div style="color:rgba(255,255,255,0.5);font-size:11px;text-transform:uppercase;">Net Units</div>
            <div id="brUnits" style="color:#fff;font-size:24px;font-weight:800;">0</div>
        </div>
        <div style="background:#141428;border:1px solid #1e1e40;border-radius:8px;padding:14px;text-align:center;">
            <div style="color:rgba(255,255,255,0.5);font-size:11px;text-transform:uppercase;">ROI</div>
            <div id="brROI" style="color:#fff;font-size:24px;font-weight:800;">0%</div>
        </div>
    </div>

    <!-- Per-person breakdown -->
    <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin:16px 0;">
        <div style="background:#141428;border:1px solid #2a2a5a;border-radius:8px;padding:12px;text-align:center;">
            <div style="color:#D4A017;font-weight:700;margin-bottom:4px;">Peter</div>
            <div id="brPeter" style="color:#fff;font-size:14px;">0-0-0 | 0u</div>
        </div>
        <div style="background:#141428;border:1px solid #2a2a5a;border-radius:8px;padding:12px;text-align:center;">
            <div style="color:#10B981;font-weight:700;margin-bottom:4px;">Chinny</div>
            <div id="brChinny" style="color:#fff;font-size:14px;">0-0-0 | 0u</div>
        </div>
        <div style="background:#141428;border:1px solid #2a2a5a;border-radius:8px;padding:12px;text-align:center;">
            <div style="color:#5588EE;font-weight:700;margin-bottom:4px;">Jimmy</div>
            <div id="brJimmy" style="color:#fff;font-size:14px;">0-0-0 | 0u</div>
        </div>
    </div>

    <!-- Pick results list -->
    <h3 style="margin-top:20px;color:#D4A017;">Pick Results</h3>
    <div style="color:rgba(255,255,255,0.4);font-size:12px;margin-bottom:8px;">Click W / L / P to grade each pick. Results save automatically.</div>
    <div id="bankrollPicks"></div>
</div>
</div>

<!-- ===== SUBMIT PICK PANEL ===== -->
<div class="sport-panel" id="panel-submit">
<div class="pick-form">
    <h2>Submit Your Pick</h2>
    <div class="form-sub">Drop your pick. It saves locally and emails the crew.</div>

    <div class="form-group">
        <label>Your Name</label>
        <select id="pickName">
            <option value="">Select...</option>
            <option value="Peter">Peter</option>
            <option value="Chinny">Chinny</option>
            <option value="Jimmy">Jimmy</option>
        </select>
    </div>

    <div class="form-row">
        <div class="form-group">
            <label>Sport</label>
            <select id="pickSport">
                <option value="">Select...</option>
                <option value="NBA">NBA</option>
                <option value="NHL">NHL</option>
                <option value="NFL">NFL</option>
                <option value="MLB">MLB</option>
                <option value="Soccer">Soccer</option>
                <option value="MMA">MMA/UFC</option>
                <option value="Boxing">Boxing</option>
                <option value="Other">Other</option>
            </select>
        </div>
        <div class="form-group">
            <label>Pick Type</label>
            <select id="pickType">
                <option value="">Select...</option>
                <option value="Spread">Spread</option>
                <option value="Moneyline">Moneyline</option>
                <option value="Over/Under">Over/Under</option>
                <option value="Prop">Prop</option>
                <option value="Parlay">Parlay</option>
                <option value="Futures">Futures</option>
            </select>
        </div>
    </div>

    <div class="form-group">
        <label>Matchup</label>
        <select id="pickMatchup">
            <option value="">Select game...</option>
        </select>
        <input type="text" id="pickMatchupCustom" placeholder="Type matchup if not listed" style="display:none;margin-top:6px;">
    </div>

    <div class="form-group">
        <label>Your Pick</label>
        <select id="pickSelection">
            <option value="">Select a game first...</option>
        </select>
        <input type="text" id="pickSelectionCustom" placeholder="Type your pick (props, parlays, etc.)" style="display:none;margin-top:6px;">
    </div>

    <div class="form-row">
        <div class="form-group">
            <label>Odds</label>
            <select id="pickOdds">
                <option value="">Select...</option>
                <option value="-110">-110 (standard)</option>
                <option value="-115">-115</option>
                <option value="-120">-120</option>
                <option value="-130">-130</option>
                <option value="-140">-140</option>
                <option value="-150">-150</option>
                <option value="-160">-160</option>
                <option value="-170">-170</option>
                <option value="-180">-180</option>
                <option value="-200">-200</option>
                <option value="-250">-250</option>
                <option value="+100">+100 (even)</option>
                <option value="+110">+110</option>
                <option value="+120">+120</option>
                <option value="+130">+130</option>
                <option value="+140">+140</option>
                <option value="+150">+150</option>
                <option value="+175">+175</option>
                <option value="+200">+200</option>
                <option value="+250">+250</option>
                <option value="+300">+300</option>
                <option value="+400">+400</option>
                <option value="+500">+500</option>
                <option value="__other__">Other (type odds)</option>
            </select>
            <input type="text" id="pickOddsCustom" placeholder="e.g. -135, +225" style="display:none;margin-top:6px;">
        </div>
        <div class="form-group">
            <label>Units</label>
            <select id="pickUnits">
                <option value="1">1 unit</option>
                <option value="2">2 units</option>
                <option value="3">3 units</option>
                <option value="5">5 units (max)</option>
            </select>
        </div>
    </div>

    <div class="form-group">
        <label>Confidence</label>
        <div class="confidence-btns">
            <div class="conf-btn" onclick="setConf(this,'Lean')">Lean</div>
            <div class="conf-btn" onclick="setConf(this,'Strong')">Strong</div>
            <div class="conf-btn" onclick="setConf(this,'Fire')">Fire</div>
        </div>
    </div>

    <div class="form-group">
        <label>Notes (optional)</label>
        <textarea id="pickNotes" placeholder="Why this pick? Edge? Gut?"></textarea>
    </div>

    <div style="display:flex;gap:8px;">
        <button class="submit-pick-btn" onclick="submitPick()" style="flex:1;">Lock This Pick</button>
        <button class="submit-pick-btn" onclick="addParlayLeg()" style="flex:1;background:#1a1a3a !important;border:1px solid #D4A017 !important;color:#D4A017 !important;">+ Add Leg</button>
    </div>

    <div id="parlayBuilder" style="display:none;margin-top:16px;background:#1a1a2a;border:1px solid #D4A017;border-radius:10px;padding:16px;">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
            <h3 style="color:#D4A017;margin:0;font-size:16px;">Parlay Builder</h3>
            <span id="parlayOdds" style="color:#D4A017;font-weight:800;font-size:18px;"></span>
        </div>
        <div id="parlayLegs"></div>
        <div style="display:flex;gap:8px;margin-top:12px;">
            <button class="submit-pick-btn" onclick="submitParlay()" style="flex:1;background:#D4A017 !important;color:#0D0D1A !important;font-weight:800;">Lock Parlay</button>
            <button class="submit-pick-btn" onclick="clearParlay()" style="flex:0 0 auto;background:transparent !important;border:1px solid #EF4444 !important;color:#EF4444 !important;padding:8px 16px;">Clear</button>
        </div>
    </div>

    <div class="pick-history" id="pickHistory">
        <h3>Today's Submitted Picks</h3>
        <div id="pickList"></div>
    </div>
</div>
</div>

</div>

<!-- BET SLIP POPUP -->
<div class="betslip-overlay" id="betslipOverlay" onclick="if(event.target===this)closeBetSlip()">
    <div class="betslip-card">
        <div class="slip-header">
            <div class="slip-title">QUICK SLIP</div>
            <button class="slip-close" onclick="closeBetSlip()">&times;</button>
        </div>
        <div class="slip-pick" id="slipPick">MIL +3.0</div>
        <div class="slip-meta" id="slipMeta">CLE @ MIL &middot; NBA &middot; Spread</div>

        <div class="slip-label">ODDS</div>
        <input type="text" class="slip-odds-input" id="slipOdds" value="-110">

        <div class="slip-label">WHO</div>
        <div class="slip-btn-group" id="slipWhoGroup">
            <div class="slip-btn" onclick="selectSlipOption('who','Peter',this)">Peter</div>
            <div class="slip-btn" onclick="selectSlipOption('who','Chinny',this)">Chinny</div>
            <div class="slip-btn" onclick="selectSlipOption('who','Jimmy',this)">Jimmy</div>
        </div>

        <div class="slip-label">UNITS</div>
        <div class="slip-btn-group" id="slipUnitsGroup">
            <div class="slip-btn active" onclick="selectSlipOption('units','1',this)">1</div>
            <div class="slip-btn" onclick="selectSlipOption('units','2',this)">2</div>
            <div class="slip-btn" onclick="selectSlipOption('units','3',this)">3</div>
            <div class="slip-btn" onclick="selectSlipOption('units','5',this)">5</div>
        </div>

        <div class="slip-label">CONFIDENCE</div>
        <div class="slip-btn-group" id="slipConfGroup">
            <div class="slip-btn active" onclick="selectSlipOption('conf','Lean',this)">Lean</div>
            <div class="slip-btn" onclick="selectSlipOption('conf','Strong',this)">Strong</div>
            <div class="slip-btn" onclick="selectSlipOption('conf','Fire',this)">Fire</div>
        </div>

        <button class="slip-note-toggle" id="slipNoteToggle" onclick="toggleSlipNote()">+ Add Note</button>
        <textarea class="slip-note-area" id="slipNoteArea" placeholder="Optional note..."></textarea>

        <button class="betslip-submit" id="slipSubmitBtn" onclick="submitBetSlip()">LOCK THIS PICK</button>
    </div>
</div>

<div class="toast" id="toast">Pick locked!</div>

<div class="footer">
    Edge Finder by Sinton.ia | Crew Dashboard | No edge = no bet<br>
    Peter (games + upsets) | Chinny (props + NHL + soccer) | Jimmy (places on Hard Rock)<br>
    Sweep → Gotcha → Trends → Card → Peter picks → Chinny picks → Lock
</div>

<!-- SUBMIT BAR -->
<div class="submit-bar" id="submitBar">
    <div class="submit-count"><strong id="pickCount">0</strong> games on card</div>
    <button class="submit-btn" onclick="lockCard()">Lock Card</button>
</div>

<!-- MODAL -->
<div class="modal-overlay" id="modalOverlay" onclick="if(event.target===this)closeModal()">
    <div class="modal">
        <h2>Locked Card</h2>
        <div class="modal-sub" id="modalDate">Edge Finder Crew</div>
        <table id="modalTable">
            <thead>
                <tr><th>#</th><th>Game</th><th>Side</th></tr>
            </thead>
            <tbody id="modalBody"></tbody>
        </table>
        <button class="modal-close" onclick="closeModal()">Close</button>
    </div>
</div>

<script>
// Safe localStorage wrapper
function safeSave(key, value) {
    try { localStorage.setItem(key, value); }
    catch(e) { console.warn('localStorage write failed for "' + key + '":', e); }
}
function safeLoad(key) {
    try { return localStorage.getItem(key); }
    catch(e) { console.warn('localStorage read failed for "' + key + '":', e); return null; }
}

// ===== TOAST QUEUE SYSTEM =====
var toastQueue = [];
var toastShowing = false;

function showToast(message, isError) {
    toastQueue.push({message: message, isError: !!isError});
    processToastQueue();
}

function processToastQueue() {
    if (toastShowing || toastQueue.length === 0) return;
    toastShowing = true;
    var item = toastQueue.shift();
    var toast = document.getElementById('toast');
    toast.textContent = item.message;
    toast.style.background = item.isError ? '#EF4444' : '#10B981';
    toast.classList.add('show');
    setTimeout(function() {
        toast.classList.remove('show');
        toast.style.background = '#10B981';
        toastShowing = false;
        setTimeout(processToastQueue, 300);
    }, 2500);
}

// State tracking
var picks = {}; // { gameName: { checked: bool, side: string } }

function refreshSlate() {
    // Reset all game row checks and side picks
    picks = {};
    localStorage.removeItem('edgeLockedPicks');
    document.querySelectorAll('.pick-check').forEach(function(el) { el.classList.remove('on'); });
    document.querySelectorAll('.game-row').forEach(function(el) { el.classList.remove('checked', 'expanded'); });
    document.querySelectorAll('.side-btn').forEach(function(el) { el.classList.remove('picked'); });

    // Reset submit form
    document.getElementById('pickName').value = '';
    document.getElementById('pickSport').value = '';
    document.getElementById('pickType').value = '';
    document.getElementById('pickMatchup').value = '';
    document.getElementById('pickMatchupCustom').value = '';
    document.getElementById('pickMatchupCustom').style.display = 'none';
    document.getElementById('pickSelection').value = '';
    document.getElementById('pickSelectionCustom').value = '';
    document.getElementById('pickSelectionCustom').style.display = 'none';
    document.getElementById('pickOdds').value = '';
    document.getElementById('pickOddsCustom').value = '';
    document.getElementById('pickOddsCustom').style.display = 'none';
    document.getElementById('pickNotes').value = '';
    document.getElementById('pickUnits').value = '1';
    document.querySelectorAll('.conf-btn').forEach(function(b) { b.classList.remove('active'); });
    selectedConf = '';

    // Re-populate dropdowns
    populateGameDropdown();
    populatePickDropdown();

    // Update submit bar
    updateSubmitBar();

    // Toast
    var toast = document.getElementById('toast');
    toast.textContent = 'Slate refreshed!';
    toast.classList.add('show');
    setTimeout(function() { toast.classList.remove('show'); }, 2000);
}

function togglePick(event, el, gameName) {
    event.stopPropagation();
    var isOn = el.classList.toggle('on');
    var row = el.closest('.game-row');
    if (isOn) {
        row.classList.add('checked');
        if (!picks[gameName]) picks[gameName] = {};
        picks[gameName].checked = true;
    } else {
        row.classList.remove('checked');
        if (picks[gameName]) picks[gameName].checked = false;
    }
    safeSave('edgeLockedPicks', JSON.stringify(picks));
    updateSubmitBar();
}

function pickSide(event, el, side) {
    event.stopPropagation();
    var row = el.closest('.game-row');
    var gameName = row.getAttribute('data-game');
    // Check if this side is already picked (toggle off)
    var wasAlreadyPicked = el.classList.contains('picked');
    // Clear other side buttons in same game
    var btns = row.querySelectorAll('.side-btn');
    btns.forEach(function(b) { b.classList.remove('picked'); });
    if (wasAlreadyPicked) {
        // Toggled off — don't open slip
        if (picks[gameName]) picks[gameName].side = '';
        safeSave('edgeLockedPicks', JSON.stringify(picks));
        return;
    }
    el.classList.add('picked');
    if (!picks[gameName]) picks[gameName] = {};
    picks[gameName].side = side;
    // Auto-check the game if not already checked
    var check = row.querySelector('.pick-check');
    if (!check.classList.contains('on')) {
        check.classList.add('on');
        row.classList.add('checked');
        picks[gameName].checked = true;
        updateSubmitBar();
    }
    safeSave('edgeLockedPicks', JSON.stringify(picks));
    // Detect sport from panel
    var panel = row.closest('.sport-panel');
    var sport = '';
    if (panel) {
        var panelId = panel.id || '';
        sport = panelId.replace('panel-', '').toUpperCase();
    }
    openBetSlip(gameName, side, sport);
}

// ===== BET SLIP POPUP =====
var slipState = {
    matchup: '', side: '', sport: '', type: '', who: '', units: '1', conf: 'Lean', odds: '-110', note: ''
};

function openBetSlip(matchup, side, sport) {
    slipState.matchup = matchup;
    slipState.side = side;
    slipState.sport = sport || '';

    // Auto-detect pick type
    var sideUpper = side.toUpperCase();
    if (sideUpper.indexOf('OVER') !== -1 || sideUpper.indexOf('UNDER') !== -1) {
        slipState.type = 'O/U';
    } else if (sideUpper.indexOf('ML') !== -1) {
        slipState.type = 'Moneyline';
    } else {
        slipState.type = 'Spread';
    }

    // Extract odds from side text if present, e.g. "MIL +3.0 (-110)" or "VAN ML +110"
    var oddsMatch = side.match(/\(([+-]\d+)\)/);
    var defaultOdds = '-110';
    if (oddsMatch) {
        defaultOdds = oddsMatch[1];
    } else if (slipState.type === 'Moneyline') {
        // For ML buttons the odds are often in the text like "VAN ML +110"
        var mlMatch = side.match(/ML\s*([+-]\d+)/);
        if (mlMatch) defaultOdds = mlMatch[1];
    }
    // Also check liveOddsMap
    if (typeof liveOddsMap !== 'undefined' && liveOddsMap[matchup]) {
        // Try exact side match
        var cleanSide = side.replace(/\s*\([^)]*\)/, '');
        if (liveOddsMap[matchup][cleanSide]) {
            defaultOdds = String(liveOddsMap[matchup][cleanSide]);
        }
    }
    slipState.odds = defaultOdds;

    // Populate UI
    document.getElementById('slipPick').textContent = side.replace(/\s*\([^)]*\)/, '');
    document.getElementById('slipMeta').textContent = matchup + ' \u00B7 ' + (sport || '?') + ' \u00B7 ' + slipState.type;
    document.getElementById('slipOdds').value = defaultOdds;

    // Restore "who" from localStorage
    var savedWho = safeLoad('edgeSlipWho') || '';
    slipState.who = savedWho;
    var whoBtns = document.querySelectorAll('#slipWhoGroup .slip-btn');
    whoBtns.forEach(function(b) {
        b.classList.remove('active');
        if (savedWho && b.textContent.trim() === savedWho) b.classList.add('active');
    });

    // Reset units to 1
    slipState.units = '1';
    var unitBtns = document.querySelectorAll('#slipUnitsGroup .slip-btn');
    unitBtns.forEach(function(b) {
        b.classList.remove('active');
        if (b.textContent.trim() === '1') b.classList.add('active');
    });

    // Reset confidence to Lean
    slipState.conf = 'Lean';
    var confBtns = document.querySelectorAll('#slipConfGroup .slip-btn');
    confBtns.forEach(function(b) {
        b.classList.remove('active');
        if (b.textContent.trim() === 'Lean') b.classList.add('active');
    });

    // Reset note
    slipState.note = '';
    document.getElementById('slipNoteArea').value = '';
    document.getElementById('slipNoteArea').style.display = 'none';
    document.getElementById('slipNoteToggle').textContent = '+ Add Note';

    // Re-enable submit
    var btn = document.getElementById('slipSubmitBtn');
    btn.disabled = false;
    btn.textContent = 'LOCK THIS PICK';

    // Show overlay
    var overlay = document.getElementById('betslipOverlay');
    overlay.style.display = 'flex';
    requestAnimationFrame(function() {
        overlay.classList.add('show');
    });
}

function closeBetSlip() {
    var overlay = document.getElementById('betslipOverlay');
    overlay.classList.remove('show');
    setTimeout(function() { overlay.style.display = 'none'; }, 300);
}

function selectSlipOption(group, value, el) {
    var parentGroup = el.parentElement;
    parentGroup.querySelectorAll('.slip-btn').forEach(function(b) { b.classList.remove('active'); });
    el.classList.add('active');
    if (group === 'who') {
        slipState.who = value;
        safeSave('edgeSlipWho', value);
    } else if (group === 'units') {
        slipState.units = value;
    } else if (group === 'conf') {
        slipState.conf = value;
    }
}

function toggleSlipNote() {
    var area = document.getElementById('slipNoteArea');
    var toggle = document.getElementById('slipNoteToggle');
    if (area.style.display === 'none' || !area.style.display) {
        area.style.display = 'block';
        area.focus();
        toggle.textContent = '- Hide Note';
    } else {
        area.style.display = 'none';
        toggle.textContent = '+ Add Note';
    }
}

function submitBetSlip() {
    if (!slipState.who) {
        var toast = document.getElementById('toast');
        toast.textContent = 'Pick WHO first!';
        toast.style.background = '#EF4444';
        toast.classList.add('show');
        setTimeout(function() { toast.classList.remove('show'); toast.style.background = '#10B981'; }, 2000);
        return;
    }

    var btn = document.getElementById('slipSubmitBtn');
    btn.disabled = true;
    btn.textContent = 'LOCKING...';

    var odds = document.getElementById('slipOdds').value || '-110';
    var note = document.getElementById('slipNoteArea').value || '';

    var pick = {
        name: slipState.who,
        sport: slipState.sport,
        type: slipState.type,
        matchup: slipState.matchup,
        selection: slipState.side.replace(/\s*\([^)]*\)/, ''),
        odds: odds,
        units: slipState.units,
        confidence: slipState.conf,
        notes: note,
        date: new Date().toLocaleDateString(),
        time: new Date().toLocaleTimeString()
    };

    // Save to localStorage for bankroll tracker compatibility
    var stored = JSON.parse(safeLoad('edgePicks') || '[]');
    stored.unshift(pick);
    safeSave('edgePicks', JSON.stringify(stored));

    // POST to server
    fetch('/api/picks', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(pick)
    }).then(function(r) {
        return r.json();
    }).then(function(data) {
        closeBetSlip();
        var toast = document.getElementById('toast');
        toast.textContent = pick.selection + ' locked!';
        toast.style.background = '#10B981';
        toast.classList.add('show');
        setTimeout(function() { toast.classList.remove('show'); }, 2500);
        renderPicks();
        renderBankroll();
    }).catch(function(err) {
        // Fallback: already saved locally
        closeBetSlip();
        var toast = document.getElementById('toast');
        toast.textContent = pick.selection + ' locked (offline)!';
        toast.style.background = '#F59E0B';
        toast.classList.add('show');
        setTimeout(function() { toast.classList.remove('show'); toast.style.background = '#10B981'; }, 2500);
        renderPicks();
        renderBankroll();
    });
}

function updateSubmitBar() {
    var count = 0;
    for (var g in picks) {
        if (picks[g].checked) count++;
    }
    document.getElementById('pickCount').textContent = count;
    var bar = document.getElementById('submitBar');
    if (count > 0) {
        bar.classList.add('visible');
    } else {
        bar.classList.remove('visible');
    }
}

function lockCard() {
    var body = document.getElementById('modalBody');
    body.innerHTML = '';
    var n = 0;
    for (var g in picks) {
        if (!picks[g].checked) continue;
        n++;
        var tr = document.createElement('tr');
        var td1 = document.createElement('td');
        td1.textContent = n;
        var td2 = document.createElement('td');
        td2.textContent = g;
        var td3 = document.createElement('td');
        td3.textContent = picks[g].side || '—';
        td3.style.color = picks[g].side ? '#D4A017' : 'rgba(255,255,255,0.3)';
        td3.style.fontWeight = '700';
        tr.appendChild(td1);
        tr.appendChild(td2);
        tr.appendChild(td3);
        body.appendChild(tr);
    }
    document.getElementById('modalOverlay').classList.add('show');
}

function closeModal() {
    document.getElementById('modalOverlay').classList.remove('show');
}

function switchSport(sport, e) {
    document.querySelectorAll('.sport-tab').forEach(function(t) { t.classList.remove('active'); });
    document.querySelectorAll('.sport-panel').forEach(function(p) { p.classList.remove('active'); });
    document.getElementById('panel-' + sport).classList.add('active');
    var ev = e || window.event;
    if (ev && ev.target) {
        var tab = ev.target.closest('.sport-tab');
        if (tab) tab.classList.add('active');
    }
    window.scrollTo(0, 0);
}

// ===== SUBMIT PICK FORM =====
var selectedConf = '';

function populateGameDropdown() {
    var select = document.getElementById('pickMatchup');
    var sport = document.getElementById('pickSport').value;
    select.innerHTML = '<option value="">Select game...</option>';

    var games = document.querySelectorAll('.game-row[data-game]');
    var added = [];

    games.forEach(function(row) {
        var game = row.getAttribute('data-game');
        if (!game || added.indexOf(game) !== -1) return;

        var sportTag = row.querySelector('.tag');
        var gameSport = sportTag ? sportTag.textContent.trim() : '';

        if (!sport || gameSport === sport) {
            var opt = document.createElement('option');
            opt.value = game;
            opt.textContent = (gameSport && sport !== gameSport ? gameSport + ' — ' : '') + game;
            select.appendChild(opt);
            added.push(game);
        }
    });

    // Also pull from table rows (NHL etc)
    document.querySelectorAll('table tr').forEach(function(tr) {
        var cells = tr.querySelectorAll('td');
        if (cells.length >= 3) {
            var tagEl = cells[1] ? cells[1].querySelector('.tag') : null;
            var rowSport = tagEl ? tagEl.textContent.trim() : '';
            var matchup = cells[2] ? cells[2].textContent.trim() : '';
            if (matchup && matchup.indexOf('@') !== -1 && added.indexOf(matchup) === -1) {
                if (!sport || rowSport === sport) {
                    var opt = document.createElement('option');
                    opt.value = matchup;
                    opt.textContent = (rowSport && sport !== rowSport ? rowSport + ' — ' : '') + matchup;
                    select.appendChild(opt);
                    added.push(matchup);
                }
            }
        }
    });

    var other = document.createElement('option');
    other.value = '__other__';
    other.textContent = 'Other (type manually)';
    select.appendChild(other);
}

document.getElementById('pickSport').addEventListener('change', function() {
    populateGameDropdown();
    populatePickDropdown();
});
document.getElementById('pickMatchup').addEventListener('change', function() {
    var custom = document.getElementById('pickMatchupCustom');
    if (this.value === '__other__') {
        custom.style.display = 'block';
        custom.focus();
    } else {
        custom.style.display = 'none';
        custom.value = '';
    }
    populatePickDropdown();
});

// Store live odds keyed by matchup -> pick -> odds
var liveOddsMap = {};

function populatePickDropdown() {
    var select = document.getElementById('pickSelection');
    var matchup = document.getElementById('pickMatchup').value;
    var pickType = document.getElementById('pickType').value;
    select.innerHTML = '<option value="">Select pick...</option>';

    var isProp = (pickType === 'Prop');
    var customInput = document.getElementById('pickSelectionCustom');

    if (isProp) {
        // Props are player-specific — show text input, hide dropdown options
        select.innerHTML = '<option value="__other__">Type your prop below</option>';
        customInput.style.display = 'block';
        customInput.placeholder = 'e.g. Donovan Mitchell O 24.5 pts, Jokic O 10.5 reb';
        return;
    } else {
        customInput.style.display = 'none';
    }

    if (matchup && matchup !== '__other__') {
        var gameRow = document.querySelector('.game-row[data-game="' + matchup + '"]');
        if (gameRow) {
            var sides = gameRow.querySelectorAll('.side-btn');
            sides.forEach(function(btn) {
                var sideText = btn.getAttribute('onclick');
                var match = sideText ? sideText.match(/'([^']+)'\)$/) : null;
                var val = match ? match[1] : btn.textContent.trim();

                // Filter by pick type
                var isSpread = val.indexOf('+') !== -1 || val.indexOf('-') !== -1;
                var isOU = val.indexOf('OVER') !== -1 || val.indexOf('UNDER') !== -1;
                var isML = val.indexOf('ML') !== -1;

                if (pickType === 'Spread' && !isSpread) return;
                if (pickType === 'Over/Under' && !isOU) return;
                if (pickType === 'Moneyline' && !isML) return;
                // No filter for Parlay, Futures, or empty — show all

                var opt = document.createElement('option');
                opt.value = val;
                opt.textContent = val;
                var oddsVal = (liveOddsMap[matchup] && liveOddsMap[matchup][val]) ? liveOddsMap[matchup][val] : '';
                if (oddsVal) {
                    opt.setAttribute('data-odds', oddsVal);
                    opt.textContent = val + ' (' + (oddsVal > 0 ? '+' : '') + oddsVal + ')';
                }
                select.appendChild(opt);
            });
        }
        document.querySelectorAll('table tr').forEach(function(tr) {
            var cells = tr.querySelectorAll('td');
            if (cells.length >= 3) {
                var rowMatchup = cells[2] ? cells[2].textContent.trim() : '';
                if (rowMatchup === matchup && cells[3]) {
                    var spread = cells[3].textContent.trim();
                    if (spread && spread !== 'TBD') {
                        var opt = document.createElement('option');
                        var val = rowMatchup.split(' @ ')[0] + ' ' + spread;
                        opt.value = val;
                        opt.textContent = val;
                        select.appendChild(opt);
                    }
                }
            }
        });
    }

    var other = document.createElement('option');
    other.value = '__other__';
    other.textContent = 'Other (type manually)';
    select.appendChild(other);
}

document.getElementById('pickSelection').addEventListener('change', function() {
    var custom = document.getElementById('pickSelectionCustom');
    if (this.value === '__other__') {
        custom.style.display = 'block';
        custom.focus();
    } else {
        custom.style.display = 'none';
        custom.value = '';
        // Auto-select odds from the pick's data-odds attribute
        var selectedOption = this.options[this.selectedIndex];
        var oddsVal = selectedOption ? selectedOption.getAttribute('data-odds') : null;
        if (oddsVal) {
            var oddsSelect = document.getElementById('pickOdds');
            var found = false;
            for (var i = 0; i < oddsSelect.options.length; i++) {
                if (oddsSelect.options[i].value === oddsVal || oddsSelect.options[i].value === '+' + oddsVal) {
                    oddsSelect.value = oddsSelect.options[i].value;
                    found = true;
                    break;
                }
            }
            // If exact match not in dropdown, set to Other and fill custom
            if (!found) {
                oddsSelect.value = '__other__';
                var oddsCustom = document.getElementById('pickOddsCustom');
                oddsCustom.style.display = 'block';
                oddsCustom.value = (oddsVal > 0 ? '+' : '') + oddsVal;
            } else {
                document.getElementById('pickOddsCustom').style.display = 'none';
                document.getElementById('pickOddsCustom').value = '';
            }
        }
    }
});

document.getElementById('pickType').addEventListener('change', populatePickDropdown);

document.getElementById('pickOdds').addEventListener('change', function() {
    var custom = document.getElementById('pickOddsCustom');
    if (this.value === '__other__') {
        custom.style.display = 'block';
        custom.focus();
    } else {
        custom.style.display = 'none';
        custom.value = '';
    }
});

// Populate on load
populateGameDropdown();

function setConf(el, level) {
    document.querySelectorAll('.conf-btn').forEach(function(b) { b.classList.remove('active'); });
    el.classList.add('active');
    selectedConf = level;
}

function submitPick() {
    var name = document.getElementById('pickName').value;
    var sport = document.getElementById('pickSport').value;
    var type = document.getElementById('pickType').value;
    var matchupVal = document.getElementById('pickMatchup').value;
    var matchup = matchupVal === '__other__' ? document.getElementById('pickMatchupCustom').value : matchupVal;
    var selVal = document.getElementById('pickSelection').value;
    var selection = selVal === '__other__' ? document.getElementById('pickSelectionCustom').value : selVal;
    var oddsVal = document.getElementById('pickOdds').value;
    var odds = oddsVal === '__other__' ? document.getElementById('pickOddsCustom').value : oddsVal;
    var units = document.getElementById('pickUnits').value;
    var notes = document.getElementById('pickNotes').value;

    if (!name || !sport || !matchup || !selection) {
        showToast('Fill in name, sport, matchup, and your pick.', true);
        return;
    }

    var pick = {
        name: name,
        sport: sport,
        type: type || 'Spread',
        matchup: matchup,
        selection: selection,
        odds: odds || 'N/A',
        units: units,
        confidence: selectedConf || 'Lean',
        notes: notes,
        date: new Date().toLocaleDateString(),
        time: new Date().toLocaleTimeString()
    };

    // Save to localStorage
    var stored = JSON.parse(safeLoad('edgePicks') || '[]');
    stored.unshift(pick);
    safeSave('edgePicks', JSON.stringify(stored));

    // POST to server
    fetch('/api/picks', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(pick)
    }).then(function(r) { return r.json(); }).catch(function() {});

    // Show toast
    var toast = document.getElementById('toast');
    toast.textContent = pick.name + "'s pick locked!";
    toast.classList.add('show');
    setTimeout(function() { toast.classList.remove('show'); }, 2500);

    // Reset form
    document.getElementById('pickMatchup').value = '';
    document.getElementById('pickMatchupCustom').value = '';
    document.getElementById('pickMatchupCustom').style.display = 'none';
    document.getElementById('pickSelection').value = '';
    document.getElementById('pickSelectionCustom').value = '';
    document.getElementById('pickSelectionCustom').style.display = 'none';
    document.getElementById('pickOdds').value = '';
    document.getElementById('pickOddsCustom').value = '';
    document.getElementById('pickOddsCustom').style.display = 'none';
    document.getElementById('pickNotes').value = '';
    populatePickDropdown();
    document.querySelectorAll('.conf-btn').forEach(function(b) { b.classList.remove('active'); });
    selectedConf = '';

    renderPicks();
}

// ===== BANKROLL TRACKER =====
function saveBankrollSettings() {
    var start = document.getElementById('bankrollStart').value || 1000;
    var unit = document.getElementById('unitSize').value || 25;
    safeSave('edgeBankrollStart', start);
    safeSave('edgeUnitSize', unit);
    renderBankroll();
    var toast = document.getElementById('toast');
    toast.textContent = 'Bankroll set: $' + start + ' / $' + unit + ' per unit';
    toast.classList.add('show');
    setTimeout(function() { toast.classList.remove('show'); }, 2000);
}

function gradePick(index, result) {
    var stored = JSON.parse(safeLoad('edgePicks') || '[]');
    if (stored[index]) {
        stored[index].result = result;
        safeSave('edgePicks', JSON.stringify(stored));
        renderBankroll();
    }
}

function calcPayout(odds, units) {
    var o = parseInt(odds);
    var u = parseFloat(units) || 1;
    if (!o) return 0;
    if (o > 0) return (o / 100) * u;
    else return (100 / Math.abs(o)) * u;
}

function renderBankroll() {
    var stored = JSON.parse(safeLoad('edgePicks') || '[]');
    var startBR = parseFloat(safeLoad('edgeBankrollStart') || '1000');
    var unitSize = parseFloat(safeLoad('edgeUnitSize') || '25');

    document.getElementById('bankrollStart').value = startBR;
    document.getElementById('unitSize').value = unitSize;

    var wins = 0, losses = 0, pushes = 0, netUnits = 0;
    var personStats = {Peter:{w:0,l:0,p:0,u:0},Chinny:{w:0,l:0,p:0,u:0},Jimmy:{w:0,l:0,p:0,u:0}};

    stored.forEach(function(pick) {
        if (!pick.result) return;
        var units = parseFloat(pick.units) || 1;
        var person = personStats[pick.name] || {w:0,l:0,p:0,u:0};

        if (pick.result === 'W') {
            wins++;
            var payout = calcPayout(pick.odds, units);
            netUnits += payout;
            person.w++;
            person.u += payout;
        } else if (pick.result === 'L') {
            losses++;
            netUnits -= units;
            person.l++;
            person.u -= units;
        } else if (pick.result === 'P') {
            pushes++;
            person.p++;
        }

        if (personStats[pick.name]) personStats[pick.name] = person;
    });

    var balance = startBR + (netUnits * unitSize);
    var totalRisked = stored.filter(function(p) { return p.result === 'W' || p.result === 'L'; }).reduce(function(sum, p) { return sum + (parseFloat(p.units) || 1); }, 0);
    var roi = totalRisked > 0 ? ((netUnits / totalRisked) * 100).toFixed(1) : 0;

    document.getElementById('brBalance').textContent = '$' + balance.toFixed(0);
    document.getElementById('brBalance').style.color = balance >= startBR ? '#10B981' : '#EF4444';
    document.getElementById('brRecord').textContent = wins + '-' + losses + '-' + pushes;
    document.getElementById('brUnits').textContent = (netUnits >= 0 ? '+' : '') + netUnits.toFixed(1) + 'u';
    document.getElementById('brUnits').style.color = netUnits >= 0 ? '#10B981' : '#EF4444';
    document.getElementById('brROI').textContent = (roi >= 0 ? '+' : '') + roi + '%';
    document.getElementById('brROI').style.color = roi >= 0 ? '#10B981' : '#EF4444';

    for (var name in personStats) {
        var s = personStats[name];
        var el = document.getElementById('br' + name);
        if (el) {
            el.textContent = s.w + '-' + s.l + '-' + s.p + ' | ' + (s.u >= 0 ? '+' : '') + s.u.toFixed(1) + 'u';
            el.style.color = s.u >= 0 ? '#10B981' : '#EF4444';
        }
    }

    // Render grading list
    var container = document.getElementById('bankrollPicks');
    container.innerHTML = '';
    stored.forEach(function(pick, i) {
        var div = document.createElement('div');
        div.style.cssText = 'display:flex;align-items:center;gap:10px;padding:10px 0;border-bottom:1px solid rgba(255,255,255,0.08);';

        var graded = pick.result || '';
        var wClass = graded === 'W' ? 'background:#10B981;color:#fff;' : 'background:transparent;border:1px solid #10B981;color:#10B981;';
        var lClass = graded === 'L' ? 'background:#EF4444;color:#fff;' : 'background:transparent;border:1px solid #EF4444;color:#EF4444;';
        var pClass = graded === 'P' ? 'background:#D4A017;color:#fff;' : 'background:transparent;border:1px solid #D4A017;color:#D4A017;';
        var btnStyle = 'cursor:pointer;padding:4px 10px;border-radius:4px;font-weight:700;font-size:12px;';

        div.innerHTML =
            '<div style="flex:1;">' +
                '<div style="color:#fff;font-weight:600;">' + (pick.selection || pick.matchup) + '</div>' +
                '<div style="color:rgba(255,255,255,0.4);font-size:12px;">' +
                    pick.name + ' | ' + (pick.sport || '?') + ' | ' + (pick.matchup || '') + ' | ' + (pick.odds || '') + ' | ' + (pick.units || 1) + 'u' +
                    (pick.type === 'Parlay' || (pick.legs && pick.legs.length) ? ' | PARLAY' : '') +
                '</div>' +
                '<div style="color:rgba(255,255,255,0.3);font-size:11px;">' + (pick.date || '') + ' ' + (pick.time || '') + '</div>' +
            '</div>' +
            '<div style="display:flex;gap:4px;">' +
                '<div style="' + btnStyle + wClass + '" onclick="gradePick(' + i + ',\'W\')">W</div>' +
                '<div style="' + btnStyle + lClass + '" onclick="gradePick(' + i + ',\'L\')">L</div>' +
                '<div style="' + btnStyle + pClass + '" onclick="gradePick(' + i + ',\'P\')">P</div>' +
            '</div>';

        container.appendChild(div);
    });

    if (stored.length === 0) {
        container.innerHTML = '<div style="color:rgba(255,255,255,0.3);text-align:center;padding:20px;">No picks yet. Submit picks and grade them here.</div>';
    }

    // Update RESULTS tab count
    var resultsTabs = document.querySelectorAll('.sport-tab');
    resultsTabs.forEach(function(tab) {
        if (tab.textContent.indexOf('RESULTS') !== -1) {
            var count = tab.querySelector('.tab-count');
            if (count) count.textContent = stored.length;
        }
    });
}

// Load bankroll on page load
renderBankroll();

// ===== GOTCHA CARD =====
function toggleGotchaEdit() {
    var display = document.getElementById('gotchaDisplay');
    var editor = document.getElementById('gotchaEditor');
    if (editor.style.display === 'none') {
        // Switch to edit mode — pull current notes into textarea
        var items = display.querySelectorAll('li');
        var lines = [];
        items.forEach(function(li) { lines.push(li.textContent.trim()); });
        editor.value = lines.join('\n');
        editor.style.display = 'block';
        display.style.display = 'none';
        editor.focus();
    } else {
        editor.style.display = 'none';
        display.style.display = 'block';
    }
}

function saveGotcha() {
    var editor = document.getElementById('gotchaEditor');
    var display = document.getElementById('gotchaDisplay');
    var text = editor.value.trim();
    if (!text) return;

    var lines = text.split('\n').filter(function(l) { return l.trim(); });
    var html = '<ul>';
    lines.forEach(function(line) {
        html += '<li>' + line.trim() + '</li>';
    });
    html += '</ul>';
    display.innerHTML = html;

    // Save to localStorage
    safeSave('edgeGotchaNBA', text);

    editor.style.display = 'none';
    display.style.display = 'block';

    var toast = document.getElementById('toast');
    toast.textContent = 'Gotcha card updated!';
    toast.classList.add('show');
    setTimeout(function() { toast.classList.remove('show'); }, 2000);
}

// Load saved gotcha on page load
(function() {
    var saved = safeLoad('edgeGotchaNBA');
    if (saved) {
        var display = document.getElementById('gotchaDisplay');
        var lines = saved.split('\n').filter(function(l) { return l.trim(); });
        var html = '<ul>';
        lines.forEach(function(line) { html += '<li>' + line.trim() + '</li>'; });
        html += '</ul>';
        display.innerHTML = html;
    }
})();

// ===== PARLAY BUILDER =====
var parlayLegs = [];

function addParlayLeg() {
    var sport = document.getElementById('pickSport').value;
    var type = document.getElementById('pickType').value;
    var matchupVal = document.getElementById('pickMatchup').value;
    var matchup = matchupVal === '__other__' ? document.getElementById('pickMatchupCustom').value : matchupVal;
    var selVal = document.getElementById('pickSelection').value;
    var selection = selVal === '__other__' ? document.getElementById('pickSelectionCustom').value : selVal;
    var oddsVal = document.getElementById('pickOdds').value;
    var odds = oddsVal === '__other__' ? document.getElementById('pickOddsCustom').value : oddsVal;

    if (!matchup || !selection) {
        showToast('Pick a game and a side first.', true);
        return;
    }

    parlayLegs.push({
        sport: sport || '?',
        type: type || 'Spread',
        matchup: matchup,
        selection: selection,
        odds: odds || '-110',
    });

    renderParlayLegs();

    // Reset pick fields but keep name and sport
    document.getElementById('pickMatchup').value = '';
    document.getElementById('pickMatchupCustom').value = '';
    document.getElementById('pickMatchupCustom').style.display = 'none';
    document.getElementById('pickSelection').innerHTML = '<option value="">Select pick...</option>';
    document.getElementById('pickSelectionCustom').value = '';
    document.getElementById('pickSelectionCustom').style.display = 'none';
    document.getElementById('pickOdds').value = '';
    document.getElementById('pickOddsCustom').value = '';
    document.getElementById('pickOddsCustom').style.display = 'none';

    // Toast
    var toast = document.getElementById('toast');
    toast.textContent = 'Leg ' + parlayLegs.length + ' added: ' + selection;
    toast.classList.add('show');
    setTimeout(function() { toast.classList.remove('show'); }, 2000);
}

function renderParlayLegs() {
    var builder = document.getElementById('parlayBuilder');
    var container = document.getElementById('parlayLegs');

    if (parlayLegs.length === 0) {
        builder.style.display = 'none';
        return;
    }

    builder.style.display = 'block';
    container.innerHTML = '';

    parlayLegs.forEach(function(leg, i) {
        var div = document.createElement('div');
        div.style.cssText = 'display:flex;justify-content:space-between;align-items:center;padding:8px 0;border-bottom:1px solid rgba(255,255,255,0.1);';
        div.innerHTML = '<div style="flex:1;">' +
            '<span style="color:#D4A017;font-weight:700;">Leg ' + (i+1) + '</span> ' +
            '<span style="color:rgba(255,255,255,0.5);font-size:12px;">' + leg.sport + ' — ' + leg.matchup + '</span><br>' +
            '<span style="color:#fff;font-weight:600;">' + leg.selection + '</span> ' +
            '<span style="color:rgba(255,255,255,0.4);">(' + leg.odds + ')</span>' +
            '</div>' +
            '<div style="cursor:pointer;color:#EF4444;padding:4px 8px;font-size:18px;" onclick="removeParlayLeg(' + i + ')">×</div>';
        container.appendChild(div);
    });

    // Calculate combined odds
    var combinedDecimal = 1;
    parlayLegs.forEach(function(leg) {
        var o = parseInt(leg.odds);
        if (!o) return;
        var decimal;
        if (o > 0) {
            decimal = (o / 100) + 1;
        } else {
            decimal = (100 / Math.abs(o)) + 1;
        }
        combinedDecimal *= decimal;
    });

    var combinedAmerican;
    if (combinedDecimal >= 2) {
        combinedAmerican = '+' + Math.round((combinedDecimal - 1) * 100);
    } else {
        combinedAmerican = '-' + Math.round(100 / (combinedDecimal - 1));
    }

    document.getElementById('parlayOdds').textContent = parlayLegs.length + ' legs — ' + combinedAmerican;
}

function removeParlayLeg(index) {
    parlayLegs.splice(index, 1);
    renderParlayLegs();
}

function clearParlay() {
    parlayLegs = [];
    renderParlayLegs();
}

function submitParlay() {
    if (parlayLegs.length < 2) {
        showToast('Need at least 2 legs for a parlay.', true);
        return;
    }

    var name = document.getElementById('pickName').value;
    var units = document.getElementById('pickUnits').value;
    var notes = document.getElementById('pickNotes').value;

    if (!name) {
        showToast('Pick your name first.', true);
        return;
    }

    // Calculate combined odds
    var combinedDecimal = 1;
    parlayLegs.forEach(function(leg) {
        var o = parseInt(leg.odds);
        if (!o) return;
        if (o > 0) combinedDecimal *= (o / 100) + 1;
        else combinedDecimal *= (100 / Math.abs(o)) + 1;
    });
    var combinedAmerican;
    if (combinedDecimal >= 2) combinedAmerican = '+' + Math.round((combinedDecimal - 1) * 100);
    else combinedAmerican = '-' + Math.round(100 / (combinedDecimal - 1));

    var legSummary = parlayLegs.map(function(l, i) {
        return 'Leg ' + (i+1) + ': ' + l.matchup + ' — ' + l.selection + ' (' + l.odds + ')';
    }).join('%0A');

    var pick = {
        name: name,
        sport: 'PARLAY',
        type: 'Parlay (' + parlayLegs.length + ' legs)',
        matchup: parlayLegs.map(function(l) { return l.matchup; }).join(' + '),
        selection: parlayLegs.map(function(l) { return l.selection; }).join(' / '),
        odds: combinedAmerican,
        units: units,
        confidence: selectedConf || 'Lean',
        notes: notes,
        date: new Date().toLocaleDateString(),
        time: new Date().toLocaleTimeString(),
        legs: parlayLegs.slice(),
    };

    // Save to localStorage
    var stored = JSON.parse(safeLoad('edgePicks') || '[]');
    stored.unshift(pick);
    safeSave('edgePicks', JSON.stringify(stored));

    // POST to server
    fetch('/api/picks', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(pick)
    }).then(function(r) { return r.json(); }).catch(function() {});

    // Toast
    var toast = document.getElementById('toast');
    toast.textContent = name + "'s " + parlayLegs.length + '-leg parlay locked! ' + combinedAmerican;
    toast.classList.add('show');
    setTimeout(function() { toast.classList.remove('show'); }, 3000);

    // Clear parlay
    parlayLegs = [];
    renderParlayLegs();

    // Reset form
    document.getElementById('pickNotes').value = '';
    document.querySelectorAll('.conf-btn').forEach(function(b) { b.classList.remove('active'); });
    selectedConf = '';

    renderPicks();
}

function renderPicks() {
    var stored = JSON.parse(safeLoad('edgePicks') || '[]');
    var today = new Date().toLocaleDateString();
    var todayPicks = stored.filter(function(p) { return p.date === today; });
    var list = document.getElementById('pickList');
    if (!todayPicks.length) {
        list.innerHTML = '<div style="color:rgba(255,255,255,0.3);font-size:13px;padding:12px;">No picks submitted today yet.</div>';
        return;
    }
    list.innerHTML = '';
    todayPicks.forEach(function(p) {
        var confClass = p.confidence === 'Fire' ? 'fire' : p.confidence === 'Strong' ? 'strong' : 'lean';
        var card = document.createElement('div');
        card.className = 'pick-card';
        card.innerHTML = '<div><div class="pick-main">' + p.selection + '</div>' +
            '<div class="pick-meta">' + p.name + ' | ' + p.sport + ' | ' + p.matchup + ' | ' + p.odds + ' | ' + p.units + 'u</div></div>' +
            '<div class="pick-conf ' + confClass + '">' + p.confidence + '</div>';
        list.appendChild(card);
    });
}

// Load picks on page load
renderPicks();

// ===== LIVE ODDS FETCH =====
var teamAbbr = {
    "Atlanta Hawks":"ATL","Boston Celtics":"BOS","Brooklyn Nets":"BKN","Charlotte Hornets":"CHA",
    "Chicago Bulls":"CHI","Cleveland Cavaliers":"CLE","Dallas Mavericks":"DAL","Denver Nuggets":"DEN",
    "Detroit Pistons":"DET","Golden State Warriors":"GS","Houston Rockets":"HOU","Indiana Pacers":"IND",
    "Los Angeles Clippers":"LAC","Los Angeles Lakers":"LAL","Memphis Grizzlies":"MEM","Miami Heat":"MIA",
    "Milwaukee Bucks":"MIL","Minnesota Timberwolves":"MIN","New Orleans Pelicans":"NOP","New York Knicks":"NYK",
    "Oklahoma City Thunder":"OKC","Orlando Magic":"ORL","Philadelphia 76ers":"PHI","Phoenix Suns":"PHX",
    "Portland Trail Blazers":"POR","Sacramento Kings":"SAC","San Antonio Spurs":"SA","Toronto Raptors":"TOR",
    "Utah Jazz":"UTA","Washington Wizards":"WAS",
    "Anaheim Ducks":"ANA","Arizona Coyotes":"ARI","Boston Bruins":"BOS","Buffalo Sabres":"BUF",
    "Calgary Flames":"CGY","Carolina Hurricanes":"CAR","Chicago Blackhawks":"CHI","Colorado Avalanche":"COL",
    "Columbus Blue Jackets":"CBJ","Dallas Stars":"DAL","Detroit Red Wings":"DET","Edmonton Oilers":"EDM",
    "Florida Panthers":"FLA","Los Angeles Kings":"LAK","Minnesota Wild":"MIN","Montreal Canadiens":"MTL",
    "Nashville Predators":"NSH","New Jersey Devils":"NJD","New York Islanders":"NYI","New York Rangers":"NYR",
    "Ottawa Senators":"OTT","Philadelphia Flyers":"PHI","Pittsburgh Penguins":"PIT","San Jose Sharks":"SJS",
    "Seattle Kraken":"SEA","St. Louis Blues":"STL","Tampa Bay Lightning":"TBL","Toronto Maple Leafs":"TOR",
    "Utah Mammoth":"UTA","Vancouver Canucks":"VAN","Vegas Golden Knights":"VGK","Washington Capitals":"WSH",
    "Winnipeg Jets":"WPG",
    // MLS
    "Atlanta United FC":"ATL","Austin FC":"AUS","Charlotte FC":"CLT","Chicago Fire FC":"CHI",
    "Colorado Rapids":"COL","Columbus Crew":"CLB","D.C. United":"DC","FC Cincinnati":"CIN",
    "FC Dallas":"DAL","Houston Dynamo FC":"HOU","Inter Miami CF":"MIA","LA Galaxy":"LAG",
    "Los Angeles FC":"LAFC","Minnesota United FC":"MIN","CF Montréal":"MTL",
    "Nashville SC":"NSH","New England Revolution":"NE","New York City FC":"NYC",
    "New York Red Bulls":"NYRB","Orlando City SC":"ORL","Philadelphia Union":"PHI",
    "Portland Timbers":"POR","Real Salt Lake":"RSL","San Jose Earthquakes":"SJ",
    "Seattle Sounders FC":"SEA","Sporting Kansas City":"SKC","St. Louis City SC":"STL",
    "Toronto FC":"TFC","Vancouver Whitecaps FC":"VAN",
    // EPL
    "Arsenal":"ARS","Aston Villa":"AVL","AFC Bournemouth":"BOU","Brentford":"BRE",
    "Brighton & Hove Albion":"BHA","Chelsea":"CHE","Crystal Palace":"CRY","Everton":"EVE",
    "Fulham":"FUL","Ipswich Town":"IPS","Leicester City":"LEI","Liverpool":"LIV",
    "Manchester City":"MCI","Manchester United":"MUN","Newcastle United":"NEW",
    "Nottingham Forest":"NFO","Southampton":"SOU","Tottenham Hotspur":"TOT",
    "West Ham United":"WHU","Wolverhampton Wanderers":"WOL",
    // La Liga
    "Real Madrid":"RMA","Barcelona":"BAR","Atletico Madrid":"ATM","Athletic Bilbao":"BIL",
    "Real Sociedad":"RSO","Real Betis":"BET","Villarreal":"VIL","Sevilla":"SEV",
    "Valencia":"VAL","Girona":"GIR","Celta Vigo":"CEL","Mallorca":"MLL",
    "Getafe":"GET","Osasuna":"OSA","Las Palmas":"LPA","Rayo Vallecano":"RAY",
    "Cadiz":"CAD","Alaves":"ALA","Granada":"GRA","Almeria":"ALM",
    // Champions League extras
    "Bayern Munich":"BAY","Borussia Dortmund":"BVB","RB Leipzig":"RBL",
    "Paris Saint-Germain":"PSG","Juventus":"JUV","AC Milan":"MIL","Inter Milan":"INT",
    "Napoli":"NAP","AS Roma":"ROM","Benfica":"BEN","Porto":"POR","Sporting CP":"SCP",
    "Ajax":"AJA","PSV Eindhoven":"PSV","Feyenoord":"FEY","Celtic":"CEL",
    "Rangers":"RAN","Club Brugge":"BRU","Red Bull Salzburg":"SAL","Shakhtar Donetsk":"SHA",
    "Galatasaray":"GAL","Fenerbahce":"FEN","Besiktas":"BES"
};

function abbr(name) { return teamAbbr[name] || name.split(' ').pop().substring(0,3).toUpperCase(); }

function formatGameTime(isoTime) {
    var d = new Date(isoTime);
    var h = d.getHours();
    var m = d.getMinutes();
    var ampm = h >= 12 ? 'PM' : 'AM';
    h = h % 12 || 12;
    return h + ':' + (m < 10 ? '0' : '') + m + ' ' + ampm;
}

function buildGameRowHTML(g) {
    var awayAbbr = abbr(g.away);
    var homeAbbr = abbr(g.home);
    var matchup = awayAbbr + ' @ ' + homeAbbr;
    var spread = g.home_spread || 0;
    var spreadStr = (spread > 0 ? '+' : '') + spread;
    var awaySpreadStr = (g.away_spread > 0 ? '+' : '') + (g.away_spread || 0);
    var total = g.total || 0;
    var gameDate = new Date(g.time);
    var time = formatGameTime(g.time);
    var dateStr = gameDate.toLocaleDateString('en-US', {weekday:'short', month:'short', day:'numeric'});
    var awayML = g.away_ml || '';
    var homeML = g.home_ml || '';

    // Check if game is today
    var now = new Date();
    var isToday = gameDate.toDateString() === now.toDateString();
    var todayStyle = isToday ? 'border-left:3px solid #D4A017;background:rgba(212,160,23,0.04);' : 'border-left:3px solid transparent;opacity:0.75;';

    // Store odds in liveOddsMap for auto-select in form
    liveOddsMap[matchup] = {};
    liveOddsMap[matchup][awayAbbr + ' ' + awaySpreadStr] = g.away_spread_odds || -110;
    liveOddsMap[matchup][homeAbbr + ' ' + spreadStr] = g.home_spread_odds || -110;
    liveOddsMap[matchup]['OVER ' + total] = g.over_odds || -110;
    liveOddsMap[matchup]['UNDER ' + total] = g.under_odds || -110;
    liveOddsMap[matchup][awayAbbr + ' ML'] = awayML;
    liveOddsMap[matchup][homeAbbr + ' ML'] = homeML;

    var fav = '';
    if (spread < 0) fav = homeAbbr;
    else if (spread > 0) fav = awayAbbr;

    // Data completeness check
    var isComplete = g.lines_complete;
    var isAvailable = g.lines_available;
    var bookSource = g.bookmaker || 'unknown';
    var fetchedAt = g.fetched_at || 'unknown';
    var dataTag = '';
    var gradeDisplay = '--';
    var gradeClass = 'gbp';

    if (!isAvailable) {
        dataTag = '<span class="tag" style="background:rgba(239,68,68,0.2);color:#EF4444;">NO LINES</span> ';
        gradeDisplay = 'N/A';
        gradeClass = 'gc';
    } else if (!isComplete && g.sport === 'SOCCER' && (g.away_ml || g.home_ml)) {
        dataTag = '<span class="tag" style="background:rgba(16,185,129,0.2);color:#10B981;">ML ONLY</span> ';
        gradeDisplay = 'ML';
        gradeClass = 'gb';
    } else if (!isComplete) {
        dataTag = '<span class="tag" style="background:rgba(251,191,36,0.2);color:#FBB024;">INCOMPLETE</span> ';
        gradeDisplay = 'INC';
        gradeClass = 'gc';
    }

    var bookTag = '<span class="tag" style="background:rgba(212,160,23,0.15);color:#D4A017;">' + bookSource.toUpperCase() + '</span> ';

    return '<div class="game-row" data-game="' + matchup + '" data-book="' + bookSource + '" data-fetched="' + fetchedAt + '" data-complete="' + (isComplete ? 'true' : 'false') + '" style="' + todayStyle + '" onclick="this.classList.toggle(\'expanded\')">' +
        '<div class="game-header">' +
            '<div class="pick-check" onclick="togglePick(event, this, \'' + matchup + '\')"></div>' +
            '<div class="game-time">' + dateStr + '<br>' + time + '</div>' +
            '<div class="game-matchup"><span class="away">' + awayAbbr + '</span> @ <span class="home">' + homeAbbr + '</span>' +
                '<div class="side-select">' +
                    '<div class="side-btn" onclick="pickSide(event,this,\'' + awayAbbr + ' ' + awaySpreadStr + '\')">' + awayAbbr + ' ' + awaySpreadStr + ' (' + (g.away_spread_odds||'-110') + ')</div>' +
                    '<div class="side-btn" onclick="pickSide(event,this,\'' + homeAbbr + ' ' + spreadStr + '\')">' + homeAbbr + ' ' + spreadStr + ' (' + (g.home_spread_odds||'-110') + ')</div>' +
                    '<div class="side-btn" onclick="pickSide(event,this,\'OVER ' + total + '\')">O ' + total + ' (' + (g.over_odds||'-110') + ')</div>' +
                    '<div class="side-btn" onclick="pickSide(event,this,\'UNDER ' + total + '\')">U ' + total + ' (' + (g.under_odds||'-110') + ')</div>' +
                    '<div class="side-btn" onclick="pickSide(event,this,\'' + awayAbbr + ' ML\')">' + awayAbbr + ' ML (' + awayML + ')</div>' +
                    '<div class="side-btn" onclick="pickSide(event,this,\'' + homeAbbr + ' ML\')">' + homeAbbr + ' ML (' + homeML + ')</div>' +
                '</div>' +
            '</div>' +
            '<div class="game-spread">' + (fav || homeAbbr) + ' ' + (spread < 0 ? spreadStr : awaySpreadStr) + '</div>' +
            '<div class="game-total">O/U ' + total + '</div>' +
            '<div class="game-grade"><span class="grade ' + gradeClass + '">' + gradeDisplay + '</span></div>' +
            '<div class="game-edge">' + dataTag + bookTag +
                'ML: ' + awayAbbr + ' (' + awayML + ') / ' + homeAbbr + ' (' + homeML + ')' +
            '</div>' +
        '</div>' +
        '<div class="game-detail">' +
            '<div class="detail-grid">' +
                '<div class="detail-box peter"><h4>Lines (' + bookSource + ')</h4>' +
                    '<p>Spread: ' + awayAbbr + ' ' + awaySpreadStr + ' (' + (g.away_spread_odds||'--') + ') / ' + homeAbbr + ' ' + spreadStr + ' (' + (g.home_spread_odds||'--') + ')<br>' +
                    'Total: O ' + total + ' (' + (g.over_odds||'--') + ') / U ' + total + ' (' + (g.under_odds||'--') + ')<br>' +
                    'ML: ' + awayAbbr + ' ' + awayML + ' / ' + homeAbbr + ' ' + homeML + '</p>' +
                    '<p style="font-size:10px;color:rgba(255,255,255,0.25);margin-top:6px;">Fetched: ' + fetchedAt + ' | Book: ' + bookSource + '</p>' +
                '</div>' +
                '<div class="detail-box trends"><h4>Notes</h4><p>' + (isComplete ? 'Lines complete. Ready for analysis.' : 'INCOMPLETE — missing data. Do not grade.') + '</p></div>' +
            '</div>' +
        '</div>' +
    '</div>';
}

function fetchLiveOdds(sport) {
    var panel = document.getElementById('panel-' + sport);
    if (!panel) return;

    // Show loading overlay
    panel.classList.add('panel-loading');
    var oldErr = panel.querySelector('.panel-error');
    if (oldErr) oldErr.remove();

    var existingRows = panel.querySelectorAll('.game-row');
    var gotcha = panel.querySelector('.gotcha-banner');

    fetch('/api/odds/' + sport)
        .then(function(r) { return r.json(); })
        .then(function(data) {
            panel.classList.remove('panel-loading');
            if (data.error) {
                var errMsg = document.createElement('div');
                errMsg.className = 'panel-error';
                errMsg.textContent = sport.toUpperCase() + ' API error: ' + data.error;
                panel.appendChild(errMsg);
                return;
            }

            // Remove old game rows (keep gotcha banner if exists)
            existingRows.forEach(function(row) { row.remove(); });

            // Remove old "no games" message if any
            var noGames = panel.querySelector('.no-games');
            if (noGames) noGames.remove();

            if (!data.games || data.games.length === 0) {
                var msg = document.createElement('div');
                msg.className = 'no-games';
                msg.style.cssText = 'text-align:center;padding:40px;color:rgba(255,255,255,0.4);';
                msg.textContent = 'No ' + sport.toUpperCase() + ' games on the slate right now.';
                panel.appendChild(msg);
                return;
            }

            // Build new rows
            var html = '';
            data.games.forEach(function(g) {
                html += buildGameRowHTML(g);
            });

            // Insert after gotcha banner or at top
            var temp = document.createElement('div');
            temp.innerHTML = html;
            while (temp.firstChild) {
                panel.appendChild(temp.firstChild);
            }

            // Update tab count
            var tabs = document.querySelectorAll('.sport-tab');
            tabs.forEach(function(tab) {
                if (tab.textContent.indexOf(sport.toUpperCase()) === 0) {
                    var count = tab.querySelector('.tab-count');
                    if (count) count.textContent = data.games.length;
                }
            });

            // Re-populate form dropdowns
            populateGameDropdown();
            populatePickDropdown();

            // Update sweep time with server timestamp
            var sweepEl = document.getElementById('sweepTime');
            if (sweepEl) {
                var serverTime = data.fetched_at || new Date().toLocaleTimeString();
                var booksUsed = (data.books_used && data.books_used.length) ? data.books_used.join(', ') : 'unknown';
                var completeCount = data.lines_complete || 0;
                var incompleteCount = data.lines_incomplete || 0;
                var noLines = data.no_lines || 0;
                var statusLine = completeCount + ' complete';
                if (incompleteCount > 0) statusLine += ', ' + incompleteCount + ' incomplete';
                if (noLines > 0) statusLine += ', ' + noLines + ' no lines';
                sweepEl.innerHTML = 'Last sweep: ' + serverTime + '<br>Books: ' + booksUsed + '<br>' + statusLine;
            }

            // Toast
            var toast = document.getElementById('toast');
            var completeN = data.lines_complete || 0;
            var incN = data.lines_incomplete || 0;
            toast.textContent = sport.toUpperCase() + ' slate loaded — ' + data.games.length + ' games (' + completeN + ' complete, ' + incN + ' incomplete)';
            toast.classList.add('show');
            setTimeout(function() { toast.classList.remove('show'); }, 3000);

            // Re-apply saved picks after DOM rebuild
            if (typeof restoreLockedPicks === 'function') restoreLockedPicks();
        })
        .catch(function(err) {
            panel.classList.remove('panel-loading');
            var errMsg = document.createElement('div');
            errMsg.className = 'panel-error';
            errMsg.textContent = 'Failed to load ' + sport.toUpperCase() + ' odds. Check connection and try again.';
            panel.appendChild(errMsg);
        });
}

// Override refreshSlate to also fetch live data AND analysis
var _originalRefreshSlate = refreshSlate;
refreshSlate = function() {
    _originalRefreshSlate();
    fetchLiveOdds('nba');
    fetchLiveOdds('nhl');
    fetchLiveOdds('soccer');
    fetchLiveOdds('mma');
    fetchLiveOdds('boxing');
    // Fetch analysis after a short delay so odds are cached first
    setTimeout(function() {
        fetchAnalysis('nba');
        fetchAnalysis('nhl');
    }, 2000);
};

// Fetch on demand only — click a sport tab or hit Refresh Slate
// No auto-fetch on load to save API credits and load time
var fetchedSports = {};
var fetchedAnalysis = {};
var _originalSwitchSport = switchSport;
switchSport = function(sport, e) {
    _originalSwitchSport(sport, e);
    // Auto-fetch when switching to a sport tab for the first time
    if (['nba','nhl','soccer','mma','boxing'].indexOf(sport) !== -1) {
        if (!fetchedSports[sport]) {
            fetchLiveOdds(sport);
            fetchedSports[sport] = true;
        }
        // Fetch analysis after odds (slight delay)
        if (!fetchedAnalysis[sport]) {
            setTimeout(function() {
                fetchAnalysis(sport);
                fetchedAnalysis[sport] = true;
            }, 1500);
        }
    }
};

// Remember last name selection
var lastName = safeLoad('edgeCrewName');
if (lastName) document.getElementById('pickName').value = lastName;
document.getElementById('pickName').addEventListener('change', function() {
    safeSave('edgeCrewName', this.value);
});

// ===== DYNAMIC DATE IN TOPBAR =====
(function() {
    var now = new Date();
    var days = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];
    var months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
    var dateStr = days[now.getDay()] + ', ' + months[now.getMonth()] + ' ' + now.getDate() + ', ' + now.getFullYear();
    document.getElementById('topbarDate').textContent = dateStr + ' | LIVE SLATE';
})();

// ===== DYNAMIC COMBINED TAB =====
var combinedData = {};
function fetchCombinedSlate() {
    fetch('/api/slate')
        .then(function(r) { return r.json(); })
        .then(function(data) {
            if (data.error) { console.error('Slate error:', data.error); return; }
            combinedData = data;
            renderCombinedTable(data);
        })
        .catch(function(err) { console.error('Combined fetch error:', err); });
}

function renderCombinedTable(data) {
    var container = document.getElementById('combinedTableContainer');
    var games = data.games || [];

    // Sort by game time
    games.sort(function(a, b) { return new Date(a.time) - new Date(b.time); });

    // Count by sport
    var sportCounts = {};
    games.forEach(function(g) {
        var s = g.sport || 'OTHER';
        sportCounts[s] = (sportCounts[s] || 0) + 1;
    });

    // Update header
    var today = new Date();
    var months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
    document.getElementById('combinedTitle').textContent = 'Full Slate \u2014 ' + months[today.getMonth()] + ' ' + today.getDate();

    var statsHtml = '';
    for (var sport in sportCounts) {
        statsHtml += '<div class="stat-pill">' + sportCounts[sport] + ' ' + sport + '</div>';
    }
    statsHtml += '<div class="stat-pill" style="color:#D4A017;">' + games.length + ' Total</div>';
    document.getElementById('combinedStats').innerHTML = statsHtml;
    document.getElementById('combinedTimestamp').textContent = 'Updated: ' + (data.fetched_at || new Date().toLocaleTimeString()) + ' | Source: ' + (data.source || 'The Odds API');

    // Update tab count
    var tabs = document.querySelectorAll('.sport-tab');
    tabs.forEach(function(tab) {
        if (tab.textContent.indexOf('Combined') !== -1) {
            var count = tab.querySelector('.tab-count');
            if (count) count.textContent = games.length;
        }
    });

    if (games.length === 0) {
        container.innerHTML = '<div style="text-align:center;padding:40px;color:rgba(255,255,255,0.4);">No games on the slate right now.</div>';
        return;
    }

    var sportColors = {
        'NBA': 'background:rgba(200,50,50,0.2);color:#E25555;',
        'NHL': 'background:rgba(50,100,200,0.2);color:#5588EE;',
        'SOCCER': 'background:rgba(16,185,129,0.2);color:#10B981;',
        'MMA': 'background:rgba(167,139,250,0.2);color:#A78BFA;',
        'BOXING': 'background:rgba(245,158,11,0.2);color:#F59E0B;'
    };

    var html = '<table style="width:100%;border-collapse:collapse;">';
    html += '<tr><th style="background:rgba(255,255,255,0.06);text-align:left;padding:10px 12px;font-size:11px;color:#D4A017;text-transform:uppercase;letter-spacing:1px;">Time</th>';
    html += '<th style="background:rgba(255,255,255,0.06);text-align:left;padding:10px;font-size:11px;color:#D4A017;text-transform:uppercase;">Sport</th>';
    html += '<th style="background:rgba(255,255,255,0.06);text-align:left;padding:10px;font-size:11px;color:#D4A017;text-transform:uppercase;">Game</th>';
    html += '<th style="background:rgba(255,255,255,0.06);text-align:left;padding:10px;font-size:11px;color:#D4A017;text-transform:uppercase;">Spread</th>';
    html += '<th style="background:rgba(255,255,255,0.06);text-align:center;padding:10px;font-size:11px;color:#D4A017;text-transform:uppercase;">O/U</th>';
    html += '<th style="background:rgba(255,255,255,0.06);text-align:center;padding:10px;font-size:11px;color:#D4A017;text-transform:uppercase;">ML</th>';
    html += '<th style="background:rgba(255,255,255,0.06);text-align:center;padding:10px;font-size:11px;color:#D4A017;text-transform:uppercase;">Book</th>';
    html += '<th style="background:rgba(255,255,255,0.06);text-align:center;padding:10px;font-size:11px;color:#D4A017;text-transform:uppercase;">Status</th></tr>';

    games.forEach(function(g) {
        var awayAbbr = abbr(g.away);
        var homeAbbr = abbr(g.home);
        var spread = g.home_spread || 0;
        var spreadStr = (spread > 0 ? '+' : '') + spread;
        var total = g.total || 0;
        var awayML = g.away_ml || '--';
        var homeML = g.home_ml || '--';
        var book = g.bookmaker || '--';
        var time = formatGameTime(g.time);
        var gameDate = new Date(g.time);
        var isToday = gameDate.toDateString() === new Date().toDateString();
        var dateLabel = isToday ? time : gameDate.toLocaleDateString('en-US', {month:'short', day:'numeric'}) + ' ' + time;
        var sportStyle = sportColors[g.sport] || 'background:rgba(255,255,255,0.1);color:#fff;';
        var statusTag = '';
        if (!g.lines_available) statusTag = '<span class="tag" style="background:rgba(239,68,68,0.2);color:#EF4444;">NO LINES</span>';
        else if (!g.lines_complete && g.sport === 'SOCCER' && (g.away_ml || g.home_ml)) statusTag = '<span class="tag" style="background:rgba(16,185,129,0.2);color:#10B981;">ML ONLY</span>';
        else if (!g.lines_complete) statusTag = '<span class="tag" style="background:rgba(251,191,36,0.2);color:#FBB024;">PARTIAL</span>';
        else statusTag = '<span class="tag" style="background:rgba(16,185,129,0.2);color:#10B981;">FULL</span>';
        var rowBg = isToday ? 'background:rgba(212,160,23,0.03);' : '';

        html += '<tr style="border-bottom:1px solid rgba(255,255,255,0.04);' + rowBg + '">';
        html += '<td style="padding:10px 12px;font-size:13px;color:rgba(255,255,255,0.5);">' + dateLabel + '</td>';
        html += '<td><span class="tag" style="' + sportStyle + '">' + g.sport + '</span></td>';
        html += '<td style="padding:10px;font-size:14px;font-weight:' + (g.lines_complete ? '700' : '400') + ';">' + awayAbbr + ' @ ' + homeAbbr + '</td>';
        html += '<td style="padding:10px;font-size:13px;color:' + (g.lines_available ? '#D4A017' : 'rgba(255,255,255,0.3)') + ';">' + (g.lines_available ? homeAbbr + ' ' + spreadStr : '--') + '</td>';
        html += '<td style="padding:10px;font-size:13px;color:rgba(255,255,255,0.5);text-align:center;">' + (total ? total : '--') + '</td>';
        html += '<td style="padding:10px;font-size:12px;color:rgba(255,255,255,0.4);text-align:center;">' + awayAbbr + ' ' + awayML + '<br>' + homeAbbr + ' ' + homeML + '</td>';
        html += '<td style="padding:10px;text-align:center;"><span class="tag" style="background:rgba(212,160,23,0.15);color:#D4A017;font-size:9px;">' + book.toUpperCase() + '</span></td>';
        html += '<td style="padding:10px;text-align:center;">' + statusTag + '</td>';
        html += '</tr>';
    });

    html += '</table>';

    // Mobile cards view
    var cardsHtml = '<div class="combined-cards-mobile" style="display:none;">';
    games.forEach(function(g) {
        var awayA = abbr(g.away);
        var homeA = abbr(g.home);
        var sp = g.home_spread || 0;
        var spStr = (sp > 0 ? '+' : '') + sp;
        var tot = g.total || 0;
        var aML = g.away_ml || '--';
        var hML = g.home_ml || '--';
        var bk = g.bookmaker || '--';
        var tm = formatGameTime(g.time);
        var gd = new Date(g.time);
        var isTd = gd.toDateString() === new Date().toDateString();
        var dl = isTd ? tm : gd.toLocaleDateString('en-US', {month:'short', day:'numeric'}) + ' ' + tm;
        var sStyle = sportColors[g.sport] || 'background:rgba(255,255,255,0.1);color:#fff;';
        var st = '';
        if (!g.lines_available) st = '<span class="tag" style="background:rgba(239,68,68,0.2);color:#EF4444;">NO LINES</span>';
        else if (!g.lines_complete && g.sport === 'SOCCER' && (g.away_ml || g.home_ml)) st = '<span class="tag" style="background:rgba(16,185,129,0.2);color:#10B981;">ML ONLY</span>';
        else if (!g.lines_complete) st = '<span class="tag" style="background:rgba(251,191,36,0.2);color:#FBB024;">PARTIAL</span>';
        else st = '<span class="tag" style="background:rgba(16,185,129,0.2);color:#10B981;">FULL</span>';

        cardsHtml += '<div class="combined-card"' + (isTd ? ' style="border-left:3px solid #D4A017;"' : '') + '>';
        cardsHtml += '<div class="combined-card-top"><span class="combined-card-matchup">' + awayA + ' @ ' + homeA + '</span>';
        cardsHtml += '<span class="combined-card-sport" style="' + sStyle + '">' + g.sport + '</span></div>';
        cardsHtml += '<div style="font-size:11px;color:rgba(255,255,255,0.4);margin-bottom:4px;">' + dl + '</div>';
        cardsHtml += '<div class="combined-card-lines">';
        if (g.lines_available) cardsHtml += '<span style="color:#D4A017;font-weight:700;">' + homeA + ' ' + spStr + '</span>';
        if (tot) cardsHtml += '<span>O/U ' + tot + '</span>';
        cardsHtml += '<span>ML: ' + awayA + ' ' + aML + ' / ' + homeA + ' ' + hML + '</span>';
        cardsHtml += '</div>';
        cardsHtml += '<div class="combined-card-status">' + st + '</div>';
        cardsHtml += '</div>';
    });
    cardsHtml += '</div>';

    container.innerHTML = html + cardsHtml;
}

// ===== DYNAMIC PETER'S GUT PICKS =====
function updatePeterGut(sport, analysisData) {
    var gutContent = document.getElementById('peterGut' + sport.toUpperCase() + 'Content');
    var gutTitle = document.getElementById('peterGut' + sport.toUpperCase() + 'Title');
    var gutTimestamp = document.getElementById('peterGut' + sport.toUpperCase() + 'Timestamp');
    if (!gutContent || !analysisData.games) return;

    var gradeOrder = {'A':1,'A-':2,'B+':3,'B':4,'B-':5,'C+':6,'C':7,'INCOMPLETE':8};
    var sorted = analysisData.games.slice().sort(function(a,b) {
        return (gradeOrder[a.grade]||9) - (gradeOrder[b.grade]||9);
    });

    var html = '';
    var n = 0;
    sorted.forEach(function(game) {
        n++;
        var gradeColor = '#D4A017';
        if (game.grade === 'A' || game.grade === 'A-') gradeColor = '#10B981';
        else if (game.grade === 'INCOMPLETE') gradeColor = '#F59E0B';
        else if (game.grade === 'C' || game.grade === 'C+') gradeColor = '#EF4444';

        var tagStr = '';
        if (game.tags && game.tags.length) {
            game.tags.forEach(function(t) {
                if (t === 'BEST BET') tagStr += '<span class="tag tag-home">' + t + '</span> ';
                else if (t === 'SHARP') tagStr += '<span class="tag tag-upset">' + t + '</span> ';
                else if (t === 'PASS' || t === 'TRAP') tagStr += '<span class="tag tag-trap">' + t + '</span> ';
                else if (t === 'B2B') tagStr += '<span class="tag tag-b2b">' + t + '</span> ';
            });
        }

        html += '<div style="margin-bottom:6px;">' +
            n + '. <strong style="color:' + gradeColor + ';">[' + game.grade + ']</strong> ' +
            '<strong>' + game.matchup + '</strong> ' + tagStr + '<br>' +
            '<span style="color:rgba(255,255,255,0.5);font-size:12px;padding-left:16px;">' + (game.peter_zone || game.edge_summary || '') + '</span>' +
            '</div>';
    });

    if (!html) html = '<p style="color:rgba(255,255,255,0.3);font-style:italic;">No analysis data yet. Hit REFRESH SLATE.</p>';

    gutContent.innerHTML = html;

    var today = new Date();
    var months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
    if (gutTitle) gutTitle.textContent = "Peter's Gut Picks \u2014 " + sport.toUpperCase() + ' ' + months[today.getMonth()] + ' ' + today.getDate();
    if (gutTimestamp) gutTimestamp.textContent = 'Generated: ' + (analysisData.generated_at || 'just now') + ' | Source: ' + (analysisData.source || 'Azure OpenAI');
}

// ===== ANALYSIS FETCH =====
function fetchAnalysis(sport) {
    var panel = document.getElementById('panel-' + sport);
    if (!panel) return;

    fetch('/api/analysis/' + sport)
        .then(function(r) { return r.json(); })
        .then(function(data) {
            if (data.error) { console.error('Analysis error:', data.error); return; }

            // Update Peter's Gut Picks dynamically
            updatePeterGut(sport, data);

            // Update gotcha banner
            var gotcha = panel.querySelector('.gotcha-banner');
            if (gotcha && data.gotcha) {
                var title = gotcha.querySelector('h3');
                var display = gotcha.querySelector('#gotchaDisplay') || gotcha;
                if (gotcha.querySelector('#gotchaDisplay')) {
                    display.innerHTML = data.gotcha;
                } else {
                    var existingUl = gotcha.querySelector('ul');
                    var existingP = gotcha.querySelector('p');
                    if (existingUl) existingUl.outerHTML = data.gotcha;
                    else if (existingP) existingP.outerHTML = data.gotcha;
                }
                if (title && data.generated_at) {
                    var sportName = sport.toUpperCase();
                    var today2 = new Date().toLocaleDateString('en-US', {month:'short', day:'numeric'});
                    title.textContent = 'Gotcha Card \u2014 ' + sportName + ' ' + today2 + ' (updated ' + data.generated_at + ')';
                }
            }

            // Update game-level analysis
            if (data.games && data.games.length) {
                data.games.forEach(function(game) {
                    var rows = panel.querySelectorAll('.game-row');
                    rows.forEach(function(row) {
                        var matchup = row.getAttribute('data-game') || '';
                        var gameMatchup = game.matchup || '';
                        if (matchup.replace(/\s/g,'').toUpperCase() === gameMatchup.replace(/\s/g,'').toUpperCase()) {
                            var gradeEl = row.querySelector('.game-grade .grade');
                            if (gradeEl && game.grade) {
                                var isIncomplete = game.grade === 'INCOMPLETE' || (game.data_status && game.data_status.indexOf('MISSING') !== -1);
                                if (isIncomplete) { gradeEl.className = 'grade gc'; gradeEl.textContent = 'INC'; }
                                else { gradeEl.className = 'grade g' + game.grade.toLowerCase().replace(/[^a-z]/g,''); gradeEl.textContent = game.grade; }
                            }
                            var edgeEl = row.querySelector('.game-edge');
                            if (edgeEl && game.edge_summary) {
                                var tags = '';
                                if (game.tags) { game.tags.forEach(function(t) {
                                    var tc = 'tag';
                                    if (t==='B2B') tc+=' tag-b2b'; else if (t==='PASS'||t==='TRAP') tc+=' tag-trap'; else if (t==='UPSET'||t==='SHARP') tc+=' tag-upset'; else if (t==='BEST BET') tc+=' tag-home';
                                    tags += '<span class="'+tc+'">'+t+'</span> ';
                                }); }
                                edgeEl.innerHTML = tags + game.edge_summary;
                            }
                            var detail = row.querySelector('.detail-grid');
                            if (detail) {
                                var peterBox = detail.querySelector('.detail-box.peter');
                                if (peterBox && game.peter_zone) peterBox.innerHTML = '<h4>Peter\'s Zone</h4><p>' + game.peter_zone + '</p>';
                                var trendsBox = detail.querySelector('.detail-box.trends');
                                if (trendsBox && game.trends && game.trends.length) {
                                    var th = '<h4>Trends</h4><ul>'; game.trends.forEach(function(t){th+='<li>'+t+'</li>';}); th+='</ul>'; trendsBox.innerHTML = th;
                                }
                                var flagsBox = detail.querySelector('.detail-box.flags');
                                if (flagsBox && game.flags && game.flags.length) {
                                    var fh = '<h4>Flags</h4><ul>'; game.flags.forEach(function(f){fh+='<li>'+f+'</li>';}); fh+='</ul>'; flagsBox.innerHTML = fh;
                                }
                                var chinnyBox = detail.querySelector('.detail-box.chinny');
                                if (chinnyBox && game.chinny_props && game.chinny_props.length) {
                                    var ch = '<h4>Chinny\'s Props Zone</h4><ul>'; game.chinny_props.forEach(function(p){ch+='<li>'+p+'</li>';}); ch+='</ul>'; chinnyBox.innerHTML = ch;
                                } else if (!chinnyBox && game.chinny_props && game.chinny_props.length) {
                                    var nc = document.createElement('div'); nc.className = 'detail-box chinny';
                                    var ch2 = '<h4>Chinny\'s Props Zone</h4><ul>'; game.chinny_props.forEach(function(p){ch2+='<li>'+p+'</li>';}); ch2+='</ul>'; nc.innerHTML = ch2; detail.appendChild(nc);
                                }
                            }
                        }
                    });
                });
            }

            // Toast
            var toast = document.getElementById('toast');
            toast.textContent = sport.toUpperCase() + ' analysis updated \u2014 ' + (data.generated_at || 'just now');
            toast.classList.add('show');
            setTimeout(function() { toast.classList.remove('show'); }, 3000);
        })
        .catch(function(err) { console.error('Analysis fetch error:', err); });
}

// ===== HOOK COMBINED INTO switchSport =====
var _origSwitchSport2 = switchSport;
switchSport = function(sport, e) {
    _origSwitchSport2(sport, e);
    if (sport === 'combined') {
        fetchCombinedSlate();
    }
};

// ===== HOOK COMBINED INTO refreshSlate =====
var _origRefreshSlate2 = refreshSlate;
refreshSlate = function() {
    _origRefreshSlate2();
    // Also refresh combined data
    setTimeout(function() { fetchCombinedSlate(); }, 3000);
};

// ===== FIX 1: DYNAMIC GOTCHA CARD DATES =====
(function() {
    var today = new Date().toLocaleDateString('en-US', {month:'short', day:'numeric'});
    var nbaH3 = document.getElementById('gotchaNBATitle');
    if (nbaH3) nbaH3.textContent = 'Gotcha Card \u2014 NBA ' + today;
    var nhlH3 = document.getElementById('gotchaNHLTitle');
    if (nhlH3) nhlH3.textContent = 'Gotcha Card \u2014 NHL ' + today;
})();

// ===== FIX 2: DYNAMIC PROPS TIMESTAMPS =====
(function() {
    var now = new Date();
    var ts = now.toLocaleDateString('en-US', {month:'short', day:'numeric', year:'numeric'}) + ' \u2014 ' + now.toLocaleTimeString('en-US', {hour:'numeric', minute:'2-digit', timeZoneName:'short'});
    var propsTs = document.getElementById('propsTimestamp');
    if (propsTs) propsTs.textContent = 'Last updated: ' + ts;
    var bottomTs = document.getElementById('propsBottomTimestamp');
    if (bottomTs) bottomTs.textContent = 'Props card generated: ' + ts + ' | Next update: before tip-off';
})();

// ===== FIX 3: UPSET SPECIALS EDIT/SAVE/LOAD =====
function toggleUpsetEdit(sport) {
    var display = document.getElementById('upset' + sport + 'Display');
    var editor = document.getElementById('upset' + sport + 'Editor');
    if (!display || !editor) return;
    if (editor.style.display === 'none') {
        // Extract current text from display rows
        var rows = display.querySelectorAll('.upset-row');
        var lines = [];
        rows.forEach(function(r) {
            var dog = r.querySelector('.upset-dog');
            var ml = r.querySelector('.upset-ml');
            var thesis = r.querySelector('.upset-thesis');
            if (dog) lines.push((dog.textContent || '') + ' | ' + (ml ? ml.textContent : '') + ' | ' + (thesis ? thesis.textContent : ''));
        });
        editor.value = lines.join('\n');
        editor.style.display = 'block';
        display.style.display = 'none';
        editor.focus();
    } else {
        editor.style.display = 'none';
        display.style.display = 'block';
    }
}

function saveUpset(sport) {
    var editor = document.getElementById('upset' + sport + 'Editor');
    var display = document.getElementById('upset' + sport + 'Display');
    if (!editor || !display) return;
    var text = editor.value.trim();
    safeSave('edgeUpset' + sport, text);
    renderUpset(sport, text);
    editor.style.display = 'none';
    display.style.display = 'block';
    var toast = document.getElementById('toast');
    // POST to server
    fetch('/api/upsets', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ sport: sport, text: text })
    }).then(function(r) {
        if (r.ok) {
            toast.textContent = sport + ' Upset Specials saved to server!';
        } else {
            toast.textContent = sport + ' Upset Specials saved locally only.';
        }
        toast.classList.add('show');
        setTimeout(function() { toast.classList.remove('show'); }, 2000);
    }).catch(function() {
        toast.textContent = sport + ' Upset Specials saved locally only.';
        toast.classList.add('show');
        setTimeout(function() { toast.classList.remove('show'); }, 2000);
    });
}

function renderUpset(sport, text) {
    var display = document.getElementById('upset' + sport + 'Display');
    if (!display) return;
    if (!text) { return; }
    var lines = text.split('\n').filter(function(l) { return l.trim(); });
    var html = '';
    lines.forEach(function(line) {
        var parts = line.split('|');
        var dog = (parts[0] || '').trim();
        var ml = (parts[1] || '').trim();
        var thesis = (parts[2] || '').trim();
        var grade = (parts[3] || '').trim() || 'B';
        var gradeClass = 'g' + grade.toLowerCase().replace(/[^a-z]/g,'');
        html += '<div class="upset-row">' +
            '<div class="upset-dog">' + dog + '</div>' +
            '<div class="upset-ml">' + ml + '</div>' +
            '<div class="upset-thesis">' + thesis + '</div>' +
            '<div class="game-grade"><span class="grade ' + gradeClass + '">' + grade + '</span></div>' +
            '</div>';
    });
    display.innerHTML = html;
}

// Load upsets from server, fall back to localStorage
(function() {
    fetch('/api/upsets').then(function(r) { return r.json(); }).then(function(data) {
        ['NBA', 'NHL'].forEach(function(sport) {
            if (data[sport]) {
                renderUpset(sport, data[sport]);
                safeSave('edgeUpset' + sport, data[sport]);
            }
        });
    }).catch(function() {
        // Server unavailable — fall back to localStorage
        var nbaSaved = safeLoad('edgeUpsetNBA');
        if (nbaSaved) renderUpset('NBA', nbaSaved);
        var nhlSaved = safeLoad('edgeUpsetNHL');
        if (nhlSaved) renderUpset('NHL', nhlSaved);
    });
})();

// ===== RESTORE LOCKED PICKS FROM LOCALSTORAGE =====
function restoreLockedPicks() {
    var saved = safeLoad('edgeLockedPicks');
    if (saved) {
        try {
            picks = JSON.parse(saved);
            for (var game in picks) {
                if (!picks[game].checked) continue;
                var row = document.querySelector('.game-row[data-game="' + game + '"]');
                if (!row) continue;
                var check = row.querySelector('.pick-check');
                if (check) check.classList.add('on');
                row.classList.add('checked');
                if (picks[game].side) {
                    var btns = row.querySelectorAll('.side-btn');
                    btns.forEach(function(b) {
                        var onclick = b.getAttribute('onclick');
                        var match = onclick ? onclick.match(/'([^']+)'\)$/) : null;
                        if (match && match[1] === picks[game].side) b.classList.add('picked');
                    });
                }
            }
            updateSubmitBar();
        } catch(e) { console.error('Failed to restore picks:', e); }
    }
}
restoreLockedPicks();

// ===== FIX 9: STALE GUT PICKS WARNING =====
var _origUpdatePeterGut = updatePeterGut;
updatePeterGut = function(sport, analysisData) {
    _origUpdatePeterGut(sport, analysisData);
    var gutTimestamp = document.getElementById('peterGut' + sport.toUpperCase() + 'Timestamp');
    if (gutTimestamp) {
        var genDate = analysisData.generated_at || '';
        var _now = new Date();
        var _months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
        var todayStr = _months[_now.getMonth()] + ' ' + String(_now.getDate()).padStart(2,'0');
        var todayStrAlt = _months[_now.getMonth()] + ' ' + _now.getDate();
        var isStale = genDate && genDate.indexOf(todayStr) === -1 && genDate.indexOf(todayStrAlt) === -1;
        if (isStale) {
            gutTimestamp.innerHTML += ' <span style="color:#EF4444;font-weight:700;"> \u2014 STALE DATA (not today). Refresh slate for current picks.</span>';
        }
    }
};

// ===== CLEAR CACHE =====
async function clearAllCache() {
    if (!confirm('Clear all data? Picks, bankroll, gotcha edits \u2014 everything.')) return;
    if ('serviceWorker' in navigator) {
        var regs = await navigator.serviceWorker.getRegistrations();
        for (var r of regs) await r.unregister();
    }
    if ('caches' in window) {
        var names = await caches.keys();
        for (var n of names) await caches.delete(n);
    }
    localStorage.clear();
    window.location.href = window.location.pathname + '?v=' + Date.now();
}
</script>

</body>
</html>
